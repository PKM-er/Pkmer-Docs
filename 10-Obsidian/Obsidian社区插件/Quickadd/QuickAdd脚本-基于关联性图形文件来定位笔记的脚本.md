---
uid: 20241026225253
title: QuickAdd è„šæœ¬ - åŸºäºå…³è”æ€§å›¾å½¢æ–‡ä»¶æ¥å®šä½ç¬”è®°çš„è„šæœ¬
tags: [quickaddè„šæœ¬, å·¥ä½œæµ, æ•°æ®æŸ¥è¯¢]
description: é€šè¿‡ç›´è§‚çš„å›¾ç‰‡å¯è§†åŒ–å±•ç¤ºï¼Œä¾¿èƒ½æ›´å¿«é€Ÿã€æ–¹ä¾¿åœ°å®šä½åˆ°ç›¸å…³ç¬”è®°ã€‚
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20241026225951
---

# QuickAdd è„šæœ¬ - åŸºäºå…³è”æ€§å›¾å½¢æ–‡ä»¶æ¥å®šä½ç¬”è®°çš„è„šæœ¬

æœ‰äº›æ—¶å€™ï¼Œä½ åªéšçº¦è®°å¾—ç¬”è®°ä¸­çš„æŸå¼ å›¾ç‰‡ï¼Œä½†å¯¹å…·ä½“çš„ç¬”è®°æˆ–å†…å®¹å´ä¸å¤ªæ¸…æ¥šï¼Œä¸çŸ¥é“ä»ä½•å…¥æ‰‹æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥å¸®åŠ©ä½ é€šè¿‡å›¾ç‰‡è½»æ¾å®šä½åˆ°ç›¸å…³ç¬”è®°ã€‚

![24.10.25_QuickAddè„šæœ¬-åŸºäºå…³è”æ€§å›¾å½¢å®šä½ç¬”è®°çš„æ–¹æ¡ˆ.md](https://cdn.pkmer.cn/images/202410262253101.png!pkmer)

> ç›®å‰ï¼Œåªé€šè¿‡ QuickAdd çš„ Macro è„šæœ¬æ¥å®ç°ï¼ŒåŠŸèƒ½è¾ƒä¸ºæœ‰é™ï¼ŒæœŸæœ›æœ‰å¤§ä½¬èƒ½å¤Ÿå¼€å‘æˆæ’ä»¶ï¼Œå®ç°æ›´å¤šåŠŸèƒ½ï¼Œä¾‹å¦‚å›¾ç‰‡çš„æ’åºå’Œæ–‡ä»¶ç±»å‹ç­›é€‰ã€‚ç†æƒ³çŠ¶æ€æ˜¯å€Ÿé‰´ Eagle ç´ æç®¡ç†ç•Œé¢çš„è®¾è®¡ï¼Œæä¾›æ›´ä¸ºçµæ´»ã€ç›´è§‚çš„å›¾ç‰‡ç®¡ç†ä½“éªŒã€‚

## åŠŸèƒ½

**é€šè¿‡å›¾ç‰‡å®šä½ç¬”è®°**ï¼šé€šè¿‡ç›´è§‚çš„å›¾ç‰‡å¯è§†åŒ–å±•ç¤ºï¼Œä¾¿èƒ½æ›´å¿«é€Ÿã€æ–¹ä¾¿åœ°å®šä½åˆ°ç›¸å…³ç¬”è®°ã€‚

![24.10.25_QuickAddè„šæœ¬-åŸºäºå…³è”æ€§å›¾å½¢å®šä½ç¬”è®°çš„æ–¹æ¡ˆ.md](https://cdn.pkmer.cn/images/202410262253029.gif)

- åŸºäºæ–‡ä»¶å¤¹ä¸­ç¬”è®°çš„æ£€ç´¢ï¼š
	- è„šæœ¬ä¼šæœç´¢æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰ç¬”è®°ä¸ä¹‹å…³è”çš„å›¾å½¢æ–‡ä»¶ã€‚
		- å¦‚æœå½“å‰ç¬”è®°æ˜¯ FolderNote æ—¶ï¼Œä¼šè‡ªåŠ¨å±•å¼€å¹¶å±•ç¤ºè¯¥æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰å›¾å½¢æ–‡ä»¶ã€‚
		- å¦‚æœå½“å‰ç¬”è®°ä¸æ˜¯ FolderNoteï¼Œåˆ™ä¼šæ˜¾ç¤ºé€‰æ‹©æ¡†ï¼Œé»˜è®¤é€‰ä¸­å½“å‰ç¬”è®°çš„çˆ¶æ–‡ä»¶å¤¹ã€‚
	- ç‰¹åˆ«é€‚é…äº† Excalidrawï¼Œå¯ä»¥ç›´æ¥åœ¨å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹åµŒå…¥çš„å›¾å½¢æ–‡ä»¶
	- ä¸æ”¯æŒ Canvas æ–‡ä»¶ã€‚
	- æ”¯æŒçš„å›¾å½¢æ–‡ä»¶ç±»å‹ï¼š`svg, gif, png, jpeg, jpg, webp, mp4`ã€‚
- å›¾ç‰‡çš„æœç´¢å®šä½
	- å›¾ç‰‡å³ä¸‹è§’çš„ğŸ”æŒ‰é’®è¢«å•å‡»æ—¶ä¼šæ¿€æ´» Obsidian çš„æœç´¢åŠŸèƒ½ï¼Œä»¥ä¾¿å¿«é€Ÿå®šä½ä½¿ç”¨è¯¥å›¾ç‰‡çš„ç¬”è®°ã€‚
	- å›¾ç‰‡å¯å•å‡»æ”¾å¤§ã€‚
	- æ¯é¡µå›¾ç‰‡æœ€å¤šæœ‰ 50 ä¸ªï¼Œå¤§äº 50 ä¸ªåˆ™å‡ºç°æ¢é¡µå™¨ã€‚

## æ³¨æ„äº‹é¡¹

- åªä¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…çš„ç¬”è®°ä¸­å¼•ç”¨çš„å›¾ç‰‡ã€‚
- ä»¥ä¸‹æƒ…å†µçš„å›¾ç‰‡å°†ä¸ä¼šè¢«æ˜¾ç¤ºï¼š
	1. å¼•ç”¨çš„ç¬”è®°ä¸åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ã€‚
	2. å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡æœªè¢«ä»»ä½•ç¬”è®°å¼•ç”¨ã€‚

## QuickAdd Macro

```js
module.exports = async () => {
  const quickAddApi = app.plugins.plugins.quickadd.api;
  const path = require('path');
  const attachmentTypes = ['svg', 'gif', 'png', 'jpeg', 'jpg', 'webp', 'mp4'];
  const itemsPerPage = 50;

  // è·å–obçš„ç›®å½•è·¯å¾„
  const listPaths = app.vault.getAllFolders().map(f => f.path);
  // listPaths.unshift("./");

  let choicePath = "";
  // è·å–ç¬”è®°çš„åŸºæœ¬è·¯å¾„
  try {
    const activeFilePath = await app.workspace.getActiveFile().path;
    const fileName = path.basename(activeFilePath);
    const isFolderNote = path.basename(path.dirname(activeFilePath)) === fileName.replace(".md", "").replace(".canvas", "");
    if (isFolderNote) {
      choicePath = path.dirname(activeFilePath);
    } else {
      listPaths.unshift(path.dirname(activeFilePath));
    }
  } catch (error) {
    console.error("è·å–æ´»åŠ¨æ–‡ä»¶è·¯å¾„æ—¶å‡ºé”™:", error);
  }

  // åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ç¬”è®°ï¼Œå¦‚æœä¸ºFolderNoteåˆ™ç›´æ¥ä½¿ç”¨å½“å‰è·¯å¾„ï¼Œå¦åˆ™å¼¹å‡ºæ–‡ä»¶å¤¹é€‰æ‹©å™¨
  if (!choicePath) {
    choicePath = await quickAddApi.suggester(listPaths, listPaths);
  }
  if (!choicePath) return;

  console.log(`é€‰æ‹©è·¯å¾„: ${choicePath}`);

  // è®°å½•å¼€å§‹æ—¶é—´
  const startTime = performance.now();

  // è·å–æ–‡ä»¶æ•°æ®
  const files = await app.vault.getFiles();
  const fileData = getMediaPathsbyFolderPath(files, choicePath, attachmentTypes);
  console.log(`è·å–äº†${fileData.length}ä¸ªåª’ä½“æ–‡ä»¶`);
  await displayMedia({ fileData, attachmentTypes, itemsPerPage });

  // åˆ›å»ºä¸€ä¸ª <style> å…ƒç´ 
  const style = document.createElement('style');
  // å®šä¹‰ CSS æ ·å¼
  const css = `
.card-container {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: flex-start;
  align-items: stretch;
  align-content: flex-start;
  gap: 10px 10px;
  width: 100%;


  .file-card {
    border: 1px solid var(--background-modifier-border);
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    background-color: var(--background-primary);
    flex: 0 1 auto;
    height: 200px;
    width: 300px;
    box-sizing: border-box;

    .media-element, .image-element {
      display: block;
      width: 100%;
      cursor: pointer;
      object-fit: contain;
      max-width: 100%;
    }
  }
}

.pagination-container {
  display: flex;
  width: 100%;
  justify-content: center;
  position: absolute;
  bottom: 20px;

  .pagination-list {
    display: flex;
    justify-content: center;
  }
}

.media-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 999;

  display: flex;
  justify-content: center;
  align-items: center;

  img, video {
    max-width: 80%;
    max-height: 80%;
  }
}
  `;

  // å°† CSS æ ·å¼æ·»åŠ åˆ° <style> å…ƒç´ ä¸­
  style.appendChild(document.createTextNode(css));

  // å°† <style> å…ƒç´ æ·»åŠ åˆ°æ–‡æ¡£çš„ <head> ä¸­
  document.head.appendChild(style);

  // !è®¡ç®—åŠ è½½æ—¶é—´
  const endTime = performance.now();
  const loadTime = ((endTime - startTime) / 1000).toFixed(2);

  // !æ˜¾ç¤ºåŠ è½½æ—¶é—´
  new Notice(`âœ” ${fileData.length}ä¸ªæ–‡ä»¶å·²åŠ è½½å®Œæ¯•! åŠ è½½æ—¶é—´: ${loadTime}ç§’`);



  async function displayMedia({ fileData, attachmentTypes, itemsPerPage = 10, page: currentPage = 1 }) {
    // !è®¡ç®—æ€»é¡µæ•°
    const totalPages = Math.ceil(fileData.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedData = fileData.slice(startIndex, endIndex);

    // ! æ–°å»ºtabé¡µ
    const isFile = await app.workspace.getActiveFile();
    const leaf = await app.workspace.getLeaf(Boolean(isFile));
    await app.workspace.setActiveLeaf(leaf);
    const container = leaf.view.containerEl.children[1];
    container.innerHTML = '';

    // åˆ›å»ºå¡ç‰‡å®¹å™¨
    const cardContainer = document.createElement("div");
    cardContainer.className = "card-container";

    // ä½¿ç”¨ Promise.all å¹¶è¡Œå¤„ç†æ–‡ä»¶å¡ç‰‡åˆ›å»º
    const cardPromises = paginatedData.map(async ({ imgPath }) => {
      const file = await app.vault.getFileByPath(imgPath);
      return createFileCard(file, attachmentTypes);
    });

    const cards = await Promise.all(cardPromises);
    cards.forEach(card => cardContainer.appendChild(card));

    container.appendChild(cardContainer);

    // æ·»åŠ åˆ†é¡µæ§ä»¶
    if (fileData.length > itemsPerPage) {
      createPaginationControls({ fileData, totalPages, currentPage, itemsPerPage, cardContainer, attachmentTypes });
    }

  };

  function createFileCard(file, attachmentTypes) {
    const card = document.createElement("div");
    card.className = "file-card";
    card.style.position = "relative";

    let mediaElement = createMediaElement(file, attachmentTypes);
    if (mediaElement) {
      card.appendChild(mediaElement);
      const searchButton = createSearchButton(file);
      card.appendChild(searchButton);
    }

    return card;
  }

  function createPaginationControls({ fileData, totalPages, currentPage, itemsPerPage, cardContainer, attachmentTypes }) {
    const paginationContainer = document.createElement("div");
    paginationContainer.className = "pagination-container";
    paginationContainer.style.display = "flex";
    paginationContainer.style.flexWrap = "wrap";

    const prevButton = document.createElement("button");
    prevButton.className = "pagination-button";
    prevButton.textContent = "ä¸Šä¸€é¡µ";
    prevButton.disabled = currentPage === 1;
    prevButton.addEventListener("click", () => {
      if (currentPage > 1) {
        displayMedia({ fileData, attachmentTypes, itemsPerPage, page: currentPage - 1 });
      }
    });
    paginationContainer.appendChild(prevButton);

    const paginationList = document.createElement("div");
    paginationList.className = "pagination-list";
    paginationList.style.display = "flex";
    paginationList.style.flexWrap = "wrap";
    paginationList.style.margin = "0 10px";
    for (let i = 1; i <= totalPages; i++) {
      const pageButton = document.createElement("button");
      pageButton.className = "pagination-button";
      pageButton.textContent = i;
      pageButton.style.margin = "2px";
      pageButton.style.padding = "5px 10px";
      pageButton.style.border = "none";
      pageButton.style.borderRadius = "3px";
      pageButton.style.cursor = "pointer";
      pageButton.style.backgroundColor = i === currentPage ? "#0033cc" : "#e0e0e0";
      pageButton.style.color = i === currentPage ? "#ffffff" : "#000000";

      pageButton.addEventListener("click", () => {
        displayMedia({ fileData, attachmentTypes, itemsPerPage, page: i });
      });

      paginationList.appendChild(pageButton);
    }
    paginationContainer.appendChild(paginationList);

    const nextButton = document.createElement("button");
    nextButton.className = "pagination-button";
    nextButton.textContent = "ä¸‹ä¸€é¡µ";
    nextButton.disabled = currentPage === totalPages;
    nextButton.addEventListener("click", () => {
      if (currentPage < totalPages) {
        displayMedia({ fileData, attachmentTypes, itemsPerPage, page: currentPage + 1 });
      }
    });
    paginationContainer.appendChild(nextButton);

    // å°†åˆ†é¡µæ§ä»¶ä½œä¸ºå…„å¼Ÿå…ƒç´ æ·»åŠ åˆ°ç°æœ‰çš„ container ä¹‹å
    cardContainer.insertAdjacentElement('afterend', paginationContainer);
    console.log('åˆ†é¡µæ§ä»¶æ·»åŠ åˆ° DOM ä¸­');
  }

  function createMediaElement(file, attachmentTypes) {
    let mediaElement;
    if (file.name.endsWith(".mp4")) {
      mediaElement = document.createElement("video");
      mediaElement.src = app.vault.getResourcePath(file);
      mediaElement.className = "media-element";
      mediaElement.controls = true;
    } else if (attachmentTypes.some(ext => file.name.endsWith(ext))) {
      mediaElement = document.createElement("img");
      mediaElement.src = app.vault.getResourcePath(file);
      mediaElement.className = "image-element";
      mediaElement.addEventListener("click", () => {
        openMediaInModal(mediaElement.src);
      });
    }
    return mediaElement;
  }

  function createSearchButton(file) {
    const searchButton = document.createElement("button");
    searchButton.innerHTML = "ğŸ”";
    searchButton.className = "search-button";
    searchButton.style.position = "absolute";
    searchButton.style.bottom = "10px";
    searchButton.style.right = "10px";
    searchButton.addEventListener("click", () => {
      const searchQuery = encodeURIComponent(file.name);
      const searchUrl = `obsidian://search?vault=${encodeURIComponent(app.vault.getName())}&query="${searchQuery}"`;
      window.open(searchUrl, '_blank');
    });
    return searchButton;
  }

  function openMediaInModal(src) {
    const modalOverlay = document.createElement("div");
    modalOverlay.className = "media-modal-overlay";

    let mediaElement;
    if (src.endsWith(".mp4")) {
      mediaElement = document.createElement("video");
      mediaElement.controls = true;
    } else {
      mediaElement = document.createElement("img");
    }
    mediaElement.src = src;
    modalOverlay.appendChild(mediaElement);

    modalOverlay.addEventListener("click", (event) => {
      if (event.target === modalOverlay) {
        document.body.removeChild(modalOverlay);
        window.isModalOpen = false;
      }
    });

    document.body.appendChild(modalOverlay);
  }

  function getFilePath(files, baseName) {
    let files2 = files.filter(f => path.basename(f.path).replace(".md", "") === path.basename(baseName).replace(".md", ""));
    let filePath = files2.map((f) => f.path);
    return filePath[0];
  }

  function getMediaPathsbyFolderPath(files, folderPath, attachmentTypes) {
    const selectFiles = folderPath === "./"
      ? files
      : files.filter(file => file.path.startsWith(`${folderPath}`));
    let allImgs = [];

    for (const file of selectFiles) {
      const cache = app.metadataCache.getFileCache(file);
      if (!cache) continue;

      let embeds = [];
      let links = [];

      const noteName = path.basename(file.path, path.extname(file.path));
      if (cache.embeds) {
        embeds = cache.embeds.map(e => ({
          link: e.link,
          position: e.position,
          noteName: noteName
        }));
      }
      if (cache.links) {
        links = cache.links.map(l => ({
          link: l.link,
          position: l.position,
          noteName: noteName
        }));
      }

      const allLinks = [...embeds, ...links];

      const media = allLinks.filter(link => {
        const fileExtension = path.extname(link.link).split('.').pop();
        return attachmentTypes.includes(fileExtension);
      });
      // console.log(`åª’ä½“æ–‡ä»¶: ${media}`);
      media.forEach(i => {
        const imgPath = getFilePath(files, i.link);
        if (imgPath) {
          allImgs.push({
            imgPath,
            notePath: file.path,
            position: i.position,
            noteName: i.noteName
          });
        }
      });
    }

    const uniqueMedia = [...new Set(allImgs.map(JSON.stringify))].map(JSON.parse);
    console.log(`æ‰¾åˆ°çš„å”¯ä¸€å›¾ç‰‡æ•°é‡: ${uniqueMedia.length}`);
    return uniqueMedia;
  }
};
```

## å‚è€ƒèµ„æ–™

1. [[QuickAddè„šæœ¬-ç§»åŠ¨å­ç¬”è®°æˆ–é™„ä»¶åˆ°å½“å‰æ–‡ä»¶å¤¹]]

