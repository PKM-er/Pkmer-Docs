---
uid: 20240908020150
title: Excalidraw Script Install Marketï¼šè½»æ¾ç®¡ç†å’Œè·å– Excalidraw è„šæœ¬
tags: [Excalidrawè„šæœ¬, æ’ä»¶å¼€å‘]
description: Excalidraw Script Install Market æ˜¯ä¸€ä¸ªæ–¹ä¾¿ä½ ä»éå®˜æ–¹è„šæœ¬å¸‚åœºçš„ Github ä»“åº“ä¸­è·å–å’Œç®¡ç† Excalidraw è„šæœ¬çš„å°å·¥å…·ã€‚é€šè¿‡è¿™ä¸ªè„šæœ¬ï¼Œä½ å¯ä»¥è½»æ¾å®‰è£…ã€æ›´æ–°å’Œç¼–è¾‘è„šæœ¬å¸‚åœºçš„ URL é“¾æ¥ï¼Œå¹¶åœ¨ä¸åŒçš„è„šæœ¬å¸‚åœºä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20240908020329
---

# Excalidraw Script Install Marketï¼šè½»æ¾ç®¡ç†å’Œè·å– Excalidraw è„šæœ¬

Excalidraw Script Install Market æ˜¯ä¸€ä¸ªæ–¹ä¾¿ä½ ä»éå®˜æ–¹è„šæœ¬å¸‚åœºçš„ Github ä»“åº“ä¸­è·å–å’Œç®¡ç† Excalidraw è„šæœ¬çš„å°å·¥å…·ã€‚é€šè¿‡è¿™ä¸ªè„šæœ¬ï¼Œä½ å¯ä»¥è½»æ¾å®‰è£…ã€æ›´æ–°å’Œç¼–è¾‘è„šæœ¬å¸‚åœºçš„ URL é“¾æ¥ï¼Œå¹¶åœ¨ä¸åŒçš„è„šæœ¬å¸‚åœºä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚

è„šæœ¬å®‰è£…é“¾æ¥ï¼š

````
```excalidraw-script-install
https://raw.githubusercontent.com/PandaNocturne/ExcalidrawScripts/master/PandaScripts/ExcalidrawScriptInstallMarket.md
```
````

> åªéœ€ä»¥ä¸‹å‡ ä¸ªç®€å•çš„æ“ä½œï¼Œå°±èƒ½æ‰¾åˆ°å¹¶ä½¿ç”¨ä½ éœ€è¦çš„è„šæœ¬ï¼Œæå‡ä½ çš„ç»˜å›¾æ•ˆç‡ã€‚

## å®‰è£… Excalidraw è„šæœ¬

è¦å®‰è£…è„šæœ¬ï¼Œè¯·ç‚¹å‡»ç•Œé¢ä¸­çš„ `å®‰è£…æ­¤è„šæœ¬/Install the script` æŒ‰é’®ã€‚å½“æŒ‰é’®æ˜¾ç¤ºä¸º `è¯¥è„šæœ¬å·²æ˜¯æœ€æ–°-ç‚¹å‡»é‡æ–°å®‰è£…/Script is up to date - Click to reinstall` æ—¶ï¼Œè¡¨ç¤ºè¯¥è„šæœ¬å·²ç»æˆåŠŸå®‰è£…ã€‚

## åˆ‡æ¢è„šæœ¬å¸‚åœº

æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»å·¦ä¾§çš„ ğŸŒname ä¸‹æ‹‰èœå•ï¼Œæ–¹ä¾¿åœ°åˆ‡æ¢ä¸åŒçš„è„šæœ¬å¸‚åœºã€‚

![24.09.08_Excalidraw Script Install Marketï¼šè½»æ¾ç®¡ç†å’Œè·å– Excalidraw è„šæœ¬.md](https://cdn.pkmer.cn/images/202409080202803.png!pkmer)

### ç¼–è¾‘ URL æº

å¦‚éœ€ç¼–è¾‘ URLï¼Œè¯·ç‚¹å‡» `ğŸ“Editor` æŒ‰é’®ã€‚æ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å…¥é“¾æ¥ï¼š

```text
name|link
```

å…¶ä¸­ï¼Œåç§°ï¼ˆnameï¼‰å’Œé“¾æ¥ï¼ˆlinkï¼‰ä¹‹é—´ç”¨ `|` ç¬¦å·åˆ†éš”ï¼Œå¤šä¸ªé“¾æ¥åˆ™ä»¥æ¢è¡Œç¬¦åˆ†å¼€ã€‚

```text
name1|link1
name2|link2
name3|link3
......
```

- **name**ï¼šæ‚¨è‡ªå®šä¹‰çš„è„šæœ¬å¸‚åœºåç§°ã€‚
- **link**ï¼šæŒ‡å‘ GitHub ä¸Šå¯¹åº” `readme.md` çš„é“¾æ¥æˆ– raw é“¾æ¥ã€‚
![24.09.08_Excalidraw Script Install Marketï¼šè½»æ¾ç®¡ç†å’Œè·å– Excalidraw è„šæœ¬.md](https://cdn.pkmer.cn/images/202409080202968.png!pkmer)

## Demo

![24.09.08_Excalidraw Script Install Marketï¼šè½»æ¾ç®¡ç†å’Œè·å– Excalidraw è„šæœ¬.md](https://cdn.pkmer.cn/images/202409080202807.gif)

## è„šæœ¬æºç 

è„šæœ¬ Github é“¾æ¥ï¼š[ExcalidrawScriptsInstallMarket](https://github.com/PandaNocturne/ExcalidrawScripts/blob/master/PandaScripts/ExcalidrawScriptInstallMarket.md)

è„šæœ¬æºç  (24.09.08)ï¼Œæœ€æ–°è„šæœ¬è¯·ä»¥ Github ä¸Šçš„ä¸ºå‡†ï¼Œéå¸¸æ¬¢è¿å¤§ä½¬å¸®å¿™ä¼˜åŒ–ã€‚

```js
class PKMerExcalidrawScriptMarket extends ea.obsidian.Modal {
  constructor(app, defaultUrls) {
    super(app);
    this.defaultUrls = defaultUrls;
  }

  async onOpen() {
    const { contentEl } = this;
    // æ·»åŠ URLè¡¨å•å¹¶å›ºå®šåœ¨é¡¶éƒ¨    
    const formContainer = contentEl.createEl('div', { cls: 'excalidraw-script-form-container' });
    const formEl = formContainer.createEl('form', { cls: 'excalidraw-script-url-form' });
    const selectEl = formEl.createEl('select', { cls: 'excalidraw-script-url-select' });
    const inputEl = formEl.createEl('input', { type: 'text', cls: 'excalidraw-script-url', placeholder: 'URL' });

    const editorButtonEl = formEl.createEl('button', { type: 'button', text: 'ğŸ“Editor' });
    const submitButtonEl = formEl.createEl('button', { type: 'submit', text: 'ğŸ”„Reload' });
    const closeButtonEl = formEl.createEl('button', { type: 'button', cls: "excalidraw-script-container-colse", text: 'âŒ' });

    // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    closeButtonEl.addEventListener('click', () => {
      this.close();
    });

    // å¡«å……ä¸‹æ‹‰èœå•
    this.defaultUrls.forEach(item => {
      selectEl.createEl('option', { text: `ğŸŒ${item.name}`, value: item.url });
    });

    // ä¸‹æ‹‰èœå•é€‰æ‹©äº‹ä»¶
    selectEl.addEventListener('change', async () => {
      inputEl.value = selectEl.value;
      await this.loadDocument(inputEl.value);
    });

    formEl.addEventListener('submit', async (event) => {
      event.preventDefault();
      const url = inputEl.value;
      await this.loadDocument(url);
    });

    // Editor æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    editorButtonEl.addEventListener('click', async () => {
      const defaultUrls = this.defaultUrls.map(item => `${item.name}|${item.url}`).join('\n');
      const input = await utils.inputPrompt(
        'è¯·ç¼–è¾‘URLï¼Œæ ¼å¼ä¸ºï¼šåç§°|URL',
        '',
        defaultUrls,
        [],
        10,
        false
      );
      const newUrls = input.split('\n').map(line => {
        const [name, url] = line.split('|');
        return { name, url };
      });
      this.defaultUrls = newUrls;
      settings["Scipts URLs"].value = newUrls;
      ea.setScriptSettings(settings);

      // æ›´æ–°ä¸‹æ‹‰èœå•
      selectEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰é€‰é¡¹
      this.defaultUrls.forEach(item => {
        selectEl.createEl('option', { text: `ğŸŒ${item.name}`, value: item.url });
      });
    });

    // æ·»åŠ æ ·å¼
    this.addStyles();
    // åˆå§‹åŠ è½½é»˜è®¤æ–‡æ¡£
    inputEl.value = this.defaultUrls[0].url || "";
    await this.loadDocument(inputEl.value, true);
  }

  async loadDocument(url) {
    const { contentEl } = this;

    // æ¸…ç©ºç°æœ‰æ–‡æ¡£å†…å®¹
    const existingDocContainer = contentEl.querySelector('.doc-container');
    if (existingDocContainer) {
      existingDocContainer.remove();
    }

    // æ·»åŠ æ˜¾ç¤ºæ–‡æ¡£å†…å®¹çš„å®¹å™¨
    const docContainer = contentEl.createEl('div', { cls: 'doc-container excalidraw-script-market' });


    // è·å–å¹¶æ˜¾ç¤ºæ–‡æ¡£å†…å®¹
    const docContent = await this.fetchDocumentContent(url);

    // ä½¿ç”¨ Obsidian çš„ Markdown æ¸²æŸ“åŠŸèƒ½
    ea.obsidian.MarkdownRenderer.renderMarkdown(docContent, docContainer, '', this);
  }

  async fetchDocumentContent(url) {
    try {
      let response;
      if (url.includes('github.com')) {
        // å°† GitHub URL è½¬æ¢ä¸º raw URL
        url = url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
      }
      response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Network response was not ok: ${response.statusText}`);
      }
      const text = await response.text();
      return text;
    } catch (error) {
      console.error('Failed to fetch document:', error);
      return '# æ— æ³•åŠ è½½æ–‡æ¡£å†…å®¹';
    }
  }
  addStyles() {
    const style = document.createElement('style');
    style.textContent = `      
    div.modal:has(.excalidraw-script-market) {
      width: 900px;
      position: relative;

      img {
        &:not(.link-favicon) {
          width: 100%;
        }

        &.coffee {
          width: 10em;
        }

        &[src*=".svg"] {
          width: 2em;
        }
      }

      .excalidraw-script-form-container {

        padding-bottom: 10px;
        border-bottom: 2px solid var(--interactive-accent);

        .excalidraw-script-url-form {
          display: flex;
          width: 100%;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;

          &>*:not(:last-child) {
            margin-right: 10px;
          }

          .excalidraw-script-url {
            flex: 0.8 1 600px;
          }

          .excalidraw-script-container-colse {
            flex: 0.1 1 10px;
          }

          button {
            flex: 0.2 1 100px;
          }
        }

      }

      .modal-close-button,
      button.copy-code-button {
        display: none;
      }

      .doc-container {
        overflow: auto;
        height: 800px;
      }
    }
    `;
    document.head.appendChild(style);
  }
  onClose() {
    // ç§»é™¤åŠ¨æ€æ·»åŠ çš„æ ·å¼
    const style = document.querySelector('style.excalidraw-script-market');
    if (style) {
      style.remove();
    }
  }
}

let settings = ea.getScriptSettings();
if (!settings["Scipts URLs"]) {
  settings = {
    "Scipts URLs": {
      value: [
        { name: 'PandaScripts', url: 'https://raw.githubusercontent.com/PandaNocturne/ExcalidrawScripts/master/README.md' },
        // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šé»˜è®¤çš„URL
        { name: 'ExcalidrawScript', url: 'https://github.com/zsviczian/obsidian-excalidraw-plugin/blob/master/ea-scripts/index-new.md' },
      ],
      hide: true,
    },
  };
  ea.setScriptSettings(settings);
}
// ä½¿ç”¨ç¤ºä¾‹
const URLs = settings["Scipts URLs"].value;
const modal = new PKMerExcalidrawScriptMarket(app, URLs);
await modal.open();
```