---
uid: 20230929013043
title: è‡ªå®šä¹‰ Excalidraw è„šæœ¬ï¼šå®ç° Zotero ä¸ Excalidraw çš„æ‹–æ‹½è”åŠ¨
tags:
  - zotero
  - workflow
  - Excalidrawè„šæœ¬
  - Excalidraw
description: 
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20231029203445
---

# è‡ªå®šä¹‰ Excalidraw è„šæœ¬ï¼šå®ç° Zotero ä¸ Excalidraw çš„æ‹–æ‹½è”åŠ¨

![image.png](https://cdn.pkmer.cn/images/202310052312620.png!pkmer)

## æ¦‚è¿°

ä¹‹å‰åˆ†äº«è¿‡ [Quicker åŠ¨ä½œä¹‹ BookxNote å’Œ Obsidian è”åŠ¨å®ç° PDF ç¬”è®°è‡ªç”±åŒ–]( https://pkmer.cn/show/20230726003600 ) å®ç°äº† Excalidraw ç”»æ¿ä¸ BookxNote çš„è”åŠ¨ï¼Œéœ€è¦å€ŸåŠ© Quicker æ¥ç‚¹å‡» 2 æ¬¡æ‰èƒ½å®Œæˆä¸€ä¸ªè¿‡ç¨‹ï¼Œæ•´ä½“ä¸‹æ¥è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼ˆä¸è¿‡æˆ‘è‡ªå·±è¿˜æ˜¯ç»å¸¸åœ¨ç”¨ï¼‰ï¼Œè¿™æ¬¡å°†ä»‹ç» Zotero ä¸ Excalidraw çš„æ— ç¼è¿æ¥ï¼Œä¸éœ€è¦å€ŸåŠ© Quickerï¼Œè€Œæ˜¯é€šè¿‡è‡ªå®šä¹‰ Excalidraw çš„è„šæœ¬ï¼Œç›´æ¥æ‹–æ‹½ Zotero çš„æ–‡æœ¬æˆ–è€…å›¾ç‰‡å°±å¯ä»¥å®ç° Zotero åˆ° Excalidraw çš„ç¬”è®°äº†ï¼Œ**æ‹–æ‹½è¿‡æ¥çš„åŒ…å«æ³¨é‡Šå’Œé€‰æ‹©çš„å†…å®¹**ã€‚

> PSï¼šæœ¬æ–‡ä½¿ç”¨çš„çš„æ˜¯ Zotero 7ï¼ŒæŒ‰ç†è¯´ Zotero 6 ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚

## å®ç°è¿‡ç¨‹

å…·ä½“å®ç°è¿‡ç¨‹éå¸¸ç®€å•ï¼Œç¬¬ä¸€æ­¥ä¿®æ”¹å¯¹åº”çš„è·¯å¾„ï¼Œç¬¬äºŒæ­¥ä¿å­˜ md æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œä¹‹åç‚¹å‡»è¿è¡Œè„šæœ¬å°±å®Œæˆäº†ã€‚

### ä¿å­˜ä¸º md æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

å°†ä¸‹é¢ä»£ç ä¿å­˜ä¸º md æ–‡ä»¶ï¼Œä¿®æ”¹æ”¾å…¥ Excalidraw æŒ‡å®šçš„ Scripts çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ Excalidraw çš„ç”»æ¿ä¸­çš„å·¥å…·é¢æ¿ä¸­å°±ä¼šå‡ºç°ä¸€ä¸ªé½¿è½®æŒ‰é’®ï¼Œéœ€è¦æ—¶ç‚¹å‡»è¿è¡Œã€‚

![Pasted image 20230929010229](https://cdn.pkmer.cn/images/Pasted%20image%2020230929010229.png!pkmer)

### ä¿®æ”¹ğŸ“Œæ³¨é‡Šçš„æ–‡ä»¶è·¯å¾„

ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œéœ€è¦ä¿®æ”¹è·¯å¾„ï¼Œ==åœ¨ç¬¬ä¸€æ¬¡å•å‡»è¿è¡Œå==ï¼Œåœ¨ Excalidraw æ’ä»¶çš„è®¾ç½®ä¸­ä¼šå‡ºç°ä»¥ä¸‹é€‰é¡¹ï¼š

![Pasted image 20231029202243](https://cdn.pkmer.cn/images/Pasted%20image%2020231029202243.png!pkmer)

> [!caution]+ æ³¨æ„ï¼šéœ€è¦å•å‡»è¿è¡Œåï¼Œæ’ä»¶è®¾ç½®æ‰ä¼šåŠ è½½è¿™ä¸ªé€‰é¡¹ã€‚

- ç¬¬ä¸€ä¸ªä¸º Zotero çš„å›¾å½¢å­˜å‚¨è·¯å¾„ï¼›
	- Zotero çš„æ ‡æ³¨å›¾ç‰‡ä¸€èˆ¬åœ¨ä½ å®šä¹‰çš„æ•°æ®åº“çš„æ–‡ä»¶å¤¹çš„**cache->library**ä¸‹é¢ï¼š
		- ![Pasted image 20230929011210](https://cdn.pkmer.cn/images/Pasted%20image%2020230929011210.png!pkmer)
- ç¬¬äºŒä¸ªå°±æ˜¯ä½ è‡ªå®šä¹‰æ‹–æ‹½è¿‡æ¥çš„å›¾ç‰‡å­˜æ”¾çš„å­˜å‚¨è·¯å¾„äº†ï¼Œæ³¨æ„è¦åœ¨ Obsidian çš„ç¬”è®°åº“ä¸­çš„==ç›¸å¯¹è·¯å¾„==ã€‚

### Zotero to Excalidraw è„šæœ¬

è¯¥è„šæœ¬çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯é€šè¿‡æ‹–æ‹½çš„æ–‡æœ¬ï¼Œå®šä½åˆ°å›¾ç‰‡åï¼Œä»è€Œå¤åˆ¶è¯¥å›¾ç‰‡åˆ° OB çš„ç¬”è®°åº“ä¸­ï¼Œå¹¶å¯¹æ‹–æ‹½çš„æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œå»é™¤å¤šä½™çš„ç©ºæ ¼ä»¥åŠå…¨è§’è½¬åŠè§’ï¼Œæ‹†åˆ†ä¸º zotero_txtã€zotero_authorã€zotero_linkã€zotero_commentã€zotero_image è¿™ 5 ä¸ªæ–‡æœ¬ï¼Œè‡ªå®šä¹‰ç»„åˆï¼š

- å¦‚æœæ‹–æ‹½æ–‡æœ¬åŒ…å« "zotero://" åˆ™è¿›è¡Œæ‹†åˆ†ç»„åˆï¼Œå¦åˆ™åªå¯¹æ–‡æœ¬è¿›è¡Œæ ¼å¼åŒ–å¤„ç†
	- åˆ¤æ–­ zotero_txt æ˜¯å¦åŒ…å«æ–‡æœ¬ï¼Ÿ
		- Trueï¼šä¸ºæ–‡æœ¬æ ‡æ³¨ï¼Œç»„åˆæ–‡æœ¬ä¸ºéœ€è¦çš„æ ¼å¼
			- åˆ¤æ–­ zotero_commentã€zotero_author æ˜¯å¦åŒ…å«æ–‡æœ¬ï¼Ÿ
				- Trueï¼šåŒ…å«æ–‡æœ¬ï¼Œå³æ·»åŠ 
				- Falseï¼šä¸ºç©ºå€¼
			- ç»„åˆ zotero_txtã€zotero_authorã€zotero_comment
			- æ·»åŠ ç»„åˆæ–‡æœ¬å¹¶å¸¦æœ‰å›é“¾ zotero_link åˆ° Excalidraw ç”»æ¿
		- Falseï¼šä¸ºå›¾ç‰‡æ ‡æ³¨
			- é€šè¿‡ match_zotero_image æ¥å›¾ç‰‡å zotero_image
				- å¤åˆ¶ Zotero çš„å›¾ç‰‡åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
					- ç­‰å¾… 0.2 ç§’æ¥å¤åˆ¶æ–‡ä»¶
			- æ·»åŠ å›¾ç‰‡å¹¶å¸¦æœ‰å›é“¾ zotero_link åˆ° Excalidraw ç”»æ¿

> [!tip]+ å¦‚æœä½ æ˜¯æ‹–æ‹½æ›¿ä»–æ–‡æœ¬ï¼Œè¯¥è„šæœ¬å¯ä»¥å¸®ä½ æ ¼å¼åŒ–å¤„ç†ä¸€ä¸‹çš„

```javascript
/*

```javascript
*/

let settings = ea.getScriptSettings();
//set default values on first run
if (!settings["Zotero Libarary Path"]) {
    settings = {
        "Zotero Libarary Path": {
            value: "D:/Zotero/cache/library",
            description: "Zotero Libraryçš„è·¯å¾„ï¼Œæ¯”å¦‚ï¼šD:/Zotero/cache/library"
        },
        "Zotero Images Path": {
            value: "Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨/ZoteroImages",
            description: "Obsidianåº“å†…å­˜æ”¾Zoteroçš„å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„ï¼Œæ¯”å¦‚ï¼šY-å›¾å½¢æ–‡ä»¶å­˜å‚¨/ZoteroImages"
        }
    };
    ea.setScriptSettings(settings);
}

const path = require('path');
const fs = require("fs");

// è·å–åº“çš„åŸºæœ¬è·¯å¾„
const basePath = (app.vault.adapter).getBasePath();
// ğŸ“Œä¿®æ”¹åˆ°Zoteroçš„libraryæ–‡ä»¶å¤¹
const zotero_library_path = settings["Zotero Libarary Path"].value;
// è®¾ç½®ç›¸å¯¹è·¯å¾„
const relativePath = settings["Zotero Images Path"].value;

// let api = ea.getExcalidrawAPI();
let el = ea.targetView.containerEl.querySelectorAll(".excalidraw-wrapper")[0];

const fillStyles = ["æ–‡å­—", "èƒŒæ™¯"];
let InsertStyle = await utils.suggester(fillStyles, fillStyles, "é€‰æ‹©æ’å…¥å¡ç‰‡é¢œè‰²çš„å½¢å¼ï¼ŒESCé€€å‡º(é»˜è®¤ç™½åº•é»‘å­—)");

el.ondrop = async function (event) {
    console.log("ondrop");
    event.preventDefault();
    var insert_txt = event.dataTransfer.getData("Text");

    // æ¸…ç©ºåŸæœ¬æŠ•å…¥çš„æ–‡æœ¬
    event.stopPropagation();
    ea.clear();

    // è®¾å®šä¸€äº›æ ·å¼
    ea.style.strokeStyle = "solid";
    
    let zotero_color = match_zotero_color(insert_txt);
    // alert(zotero_color);

    if (zotero_color) {
        // å¡ç‰‡èƒŒæ™¯é¢œè‰²
        if (InsertStyle == "èƒŒæ™¯") {
            ea.style.backgroundColor = zotero_color;
            ea.style.strokeColor = "#1e1e1e"
        } else if (InsertStyle == "æ–‡å­—") {
            ea.style.backgroundColor = "#ffffff";
            ea.style.strokeColor = zotero_color;
        } else {
            ea.style.backgroundColor = "#ffffff";
            ea.style.strokeColor = "#1e1e1e"
        }
    } else {
        ea.style.backgroundColor = "#ffffff";
        ea.style.strokeColor = "#1e1e1e"
    }

    ea.style.fillStyle = 'solid';
    ea.style.roughness = 0;
    // ea.style.roundness = { type: 3 }; // åœ†è§’
    ea.style.strokeWidth = 2;
    ea.style.fontFamily = 4;
    ea.style.fontSize = 20;

    // æ ¼å¼åŒ–æ–‡æœ¬(å»ç©ºæ ¼ã€å…¨è§’è½¬åŠè§’)  
    insert_txt = processText(insert_txt)

    if (insert_txt.includes("zotero://")) {
        console.log("Zotero");

        zotero_txt = match_zotero_txt(insert_txt);
        zotero_author = match_zotero_author(insert_txt);
        if (zotero_author) {
            zotero_author = `(${zotero_author})`;
        };
        zotero_comment = match_zotero_comment(insert_txt);
        if (zotero_comment) {
            zotero_comment = `\n\nğŸ“ï¼š${zotero_comment}`;
        };
        zotero_link = match_zotero_link(insert_txt);

        if (zotero_txt) {
            console.log("ZoteroText");

            let id = await ea.addText(0, 0, `ğŸ“–ï¼š${zotero_txt}${zotero_author}${zotero_comment}`, { width: 600, box: true, wrapAt: 90, textAlign: "left", textVerticalAlign: "middle", box: "box" });
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        } else {
            console.log("ZoteroImage");
            let zotero_image = match_zotero_image(insert_txt);
            let zotero_image_name = `${zotero_image}.png`;
            let Obsidian_image_Path = `${basePath}/${relativePath}/${zotero_image_name}`;

            // å¦‚æœObçš„è·¯å¾„ä¸å­˜åœ¨åˆ™åˆ›å»º
            if (!fs.existsSync(`${basePath}/${relativePath}`)) {
                fs.mkdirSync(path.dirname(`${basePath}/${relativePath}`), { recursive: true });
            }
            let zotero_image_path = `${zotero_library_path}/${zotero_image_name}`;

            // å¤åˆ¶zoteroçš„å›¾ç‰‡åˆ°Obsidiançš„ç¬”è®°åº“
            fs.copyFileSync(zotero_image_path, Obsidian_image_Path);

            await new Promise((resolve) => setTimeout(resolve, 200)); // æš‚åœ0.2ç§’ï¼Œç­‰å¾…å¤åˆ¶æ–‡ä»¶çš„è¿‡ç¨‹

            let id = await ea.addImage(0, 0, zotero_image_name);
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        };

    } else {
        let id = await ea.addText(0, 0, `${insert_txt} `, { width: 400, box: true, wrapAt: 90, textAlign: "left", textVerticalAlign: "middle", box: "box" });
        let el = ea.getElement(id);
        await ea.addElementsToView(true, false, false);
        if (ea.targetView.draginfoDiv) {
            document.body.removeChild(ea.targetView.draginfoDiv);
            delete ea.targetView.draginfoDiv;
        };

    };
};

new Notice("ZoteroToExcalidrawè„šæœ¬å·²å¯åŠ¨ï¼");

function processText(text) {
    // æ›¿æ¢è‹±æ–‡ä¹‹é—´çš„å¤šä¸ªç©ºæ ¼ä¸ºä¸€ä¸ªç©ºæ ¼
    text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');
    // åˆ é™¤ä¸­æ–‡ä¹‹é—´çš„ç©ºæ ¼
    text = text.replace(/([\u4e00-\u9fa5])\s+([\u4e00-\u9fa5])/g, '$1$2');
    text = text.replace(/([\u4e00-\u9fa5])\s+/g, '$1');
    text = text.replace(/\s+([\u4e00-\u9fa5])/g, '$1');
    // å°†å…¨è§’å­—ç¬¦è½¬æ¢ä¸ºåŠè§’å­—ç¬¦
    text = text.replace(/[\uFF01-\uFF5E]/g, function (match) { return String.fromCharCode(match.charCodeAt(0) - 65248); });

    // // åœ¨ä¸­è‹±æ–‡ä¹‹é—´æ·»åŠ ç©ºæ ¼
    // text = text.replace(/([\u4e00-\u9fa5])([a-zA-Z])/g, '$1 $2');
    // text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');

    return text;
}

function match_zotero_color(text) {
    const regex = /#[a-zA-Z0-9]{6}/;
    const matches = text.match(regex);
    return matches ? matches[0] : "";
}

function match_zotero_txt(text) {
    const regex = /â€œ(.*)â€ \(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_author(text) {
    const regex = /\(\[(.*\d+)]\(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_link(text) {
    const regex = /\[pdf\]\((.*)\)\)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_comment(text) {
    const regex = /.*\)\).*\)\)([\s\S]*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_image(text) {
    const regex = /annotation=(\w*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}
```

## æ·»åŠ å¡ç‰‡é¢œè‰²

å¦‚æœä½ æƒ³æ·»åŠ æ ‡æ³¨çš„å¡ç‰‡é¢œè‰²ï¼Œå¯ä»¥åœ¨**é¦–é€‰é¡¹ ->é«˜çº§ä¸­ç¼–è¾‘å™¨ ->æœç´¢ï¼š`annotations.noteTemplates`**ï¼Œä¿®æ”¹é«˜äº®æ ‡æ³¨çš„æ¨¡æ¿ï¼Œæ·»åŠ {{color}}å±æ€§ï¼Œå…¶ä»–å±æ€§è§å®˜æ–¹æ–‡æ¡£ï¼š[note templates [Zotero Documentation]](https://www.zotero.org/support/note_templates)ï¼š

![Pasted image 20231017234906](https://cdn.pkmer.cn/images/Pasted%20image%2020231017234906.png!pkmer)

```
<p>{{color}} {{highlight}} {{citation}} {{comment}}</p>
```


> [!caution]+ ä¸è¦éšæ„ä¿®æ”¹ NoteTemplate
> å› ä¸ºè¯¥è„šæœ¬æ˜¯é€šè¿‡æ–‡æœ¬æ­£åˆ™åŒ¹é…çš„ï¼Œæ‰€ä»¥å½“ä½ ä¿®æ”¹äº†é«˜äº®çš„æ¨¡æ¿æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å¯èƒ½ä¼šå¤±æ•ˆï¼Œå¦‚æœä½ æƒ³åŒ¹é…è‡ªå·±çš„æ¨¡æ¿ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹åŒ¹é…æ¡ä»¶ã€‚

è®¾ç½®å®Œæˆä¹‹åï¼Œå†è¿è¡Œè¯¥è„šæœ¬ï¼Œæ’å…¥çš„å¡ç‰‡å°±å¯ä»¥æ ¹æ®åŒ¹é…æ ‡æ³¨çš„é¢œè‰²äº†ï¼Œæ ¹æ®é€‰æ‹©å¯ä»¥è®¾ç½® 2 ç§å¡ç‰‡é¢œè‰²æ–¹æ¡ˆï¼š

> [!cite]+ [[Memos20231017105429]]
> ![Pasted image 20231017233449](https://cdn.pkmer.cn/images/Pasted%20image%2020231017233449.png!pkmer)

> [!tip]+ ç¦ç”¨å¡ç‰‡æ–‡å­—å¼¹çª—
> å¦‚æœä½ ä¸éœ€è¦è®¾å®šé¢œè‰²ï¼Œå¯ä»¥ ESCï¼Œæˆ–è€…æ³¨é‡Šæ‰è¿™ä¸ªå¼¹çª—çš„ä»£ç ã€‚
> ![Pasted image 20231017233512](https://cdn.pkmer.cn/images/Pasted%20image%2020231017233512.png!pkmer)

> æ³¨é‡Šæ‰è¿™ä¸€è¡Œï¼š
>
> ```
> let InsertStyle = await utils.suggester(fillStyles, fillStyles, "é€‰æ‹©æ’å…¥å¡ç‰‡é¢œè‰²çš„å½¢å¼ï¼ŒESCé€€å‡º(é»˜è®¤ç™½åº•é»‘å­—)");
> ```