---
uid: 20230929013043
title: è‡ªå®šä¹‰ Excalidraw è„šæœ¬ï¼šå®ç° Zotero ä¸ Excalidraw çš„æ‹–æ‹½è”åŠ¨
tags: [zotero, excalidraw, workflow]
description: 
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20231005231228
---

# è‡ªå®šä¹‰ Excalidraw è„šæœ¬ï¼šå®ç° Zotero ä¸ Excalidraw çš„æ‹–æ‹½è”åŠ¨

![image.png](https://cdn.pkmer.cn/images/202310052312620.png!pkmer)

## æ¦‚è¿°

ä¹‹å‰åˆ†äº«è¿‡ [[QuickeråŠ¨ä½œä¹‹BookxNoteå’ŒObsidianè”åŠ¨]] å®ç°äº† Excalidraw ç”»æ¿ä¸ BookxNote çš„è”åŠ¨ï¼Œéœ€è¦å€ŸåŠ© Quicker æ¥ç‚¹å‡» 2 æ¬¡æ‰èƒ½å®Œæˆä¸€ä¸ªè¿‡ç¨‹ï¼Œæ•´ä½“ä¸‹æ¥è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼ˆä¸è¿‡æˆ‘è‡ªå·±è¿˜æ˜¯ç»å¸¸åœ¨ç”¨ï¼‰ï¼Œè¿™æ¬¡å°†ä»‹ç» Zotero ä¸ Excalidraw çš„æ— ç¼è¿æ¥ï¼Œä¸éœ€è¦å€ŸåŠ© Quickerï¼Œè€Œæ˜¯é€šè¿‡è‡ªå®šä¹‰ Excalidraw çš„è„šæœ¬ï¼Œç›´æ¥æ‹–æ‹½ Zotero çš„æ–‡æœ¬æˆ–è€…å›¾ç‰‡å°±å¯ä»¥å®ç° Zotero åˆ° Excalidraw çš„ç¬”è®°äº†ï¼Œ**æ‹–æ‹½è¿‡æ¥çš„åŒ…å«æ³¨é‡Šå’Œé€‰æ‹©çš„å†…å®¹**ã€‚

> PSï¼šæœ¬æ–‡ä½¿ç”¨çš„çš„æ˜¯ Zotero-7.0.0-beta.24ï¼ŒæŒ‰ç†è¯´ Zotero 6 ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚

![GIF-230929 092151](https://cdn.pkmer.cn/images/202310052308679.gif)

## å®ç°è¿‡ç¨‹

å…·ä½“å®ç°è¿‡ç¨‹éå¸¸ç®€å•ï¼Œç¬¬ä¸€æ­¥ä¿®æ”¹å¯¹åº”çš„è·¯å¾„ï¼Œç¬¬äºŒæ­¥ä¿å­˜ md æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œä¹‹åç‚¹å‡»è¿è¡Œè„šæœ¬å°±å®Œæˆäº†ã€‚

### ä¿®æ”¹ğŸ“Œæ³¨é‡Šçš„æ–‡ä»¶è·¯å¾„

ä¿®æ”¹ [[#Zotero to Excalidraw è„šæœ¬]] ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶è·¯å¾„ï¼š

![93ba923af767612ad034ed811367fc18](https://cdn.pkmer.cn/images/202310052308038.png!pkmer)

- ç¬¬ä¸€ä¸ªä¸º Zotero çš„å›¾å½¢å­˜å‚¨è·¯å¾„ï¼›
	- Zotero çš„æ ‡æ³¨å›¾ç‰‡ä¸€èˆ¬åœ¨ä½ å®šä¹‰çš„æ•°æ®åº“çš„æ–‡ä»¶å¤¹çš„**cache->library**ä¸‹é¢ï¼š
		- ![c19e0101f275c6dfb8384083b33dc712](https://cdn.pkmer.cn/images/202310052308015.png!pkmer)
- ç¬¬äºŒä¸ªå°±æ˜¯ä½ è‡ªå®šä¹‰æ‹–æ‹½è¿‡æ¥çš„å›¾ç‰‡å­˜æ”¾çš„å­˜å‚¨è·¯å¾„äº†ï¼Œæ³¨æ„è¦åœ¨ Obsidian çš„ç¬”è®°åº“ä¸­ã€‚

### ä¿å­˜ä¸º md æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

ä¿®æ”¹å®Œè·¯å¾„åå°†ä¸‹é¢ä»£ç ä¿å­˜ä¸º md æ–‡ä»¶ï¼Œä¿®æ”¹æ”¾å…¥ Excalidraw æŒ‡å®šçš„ Scripts çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ Excalidraw çš„ç”»æ¿ä¸­çš„å·¥å…·é¢æ¿ä¸­å°±ä¼šå‡ºç°ä¸€ä¸ªé½¿è½®æŒ‰é’®ï¼Œéœ€è¦æ—¶ç‚¹å‡»è¿è¡Œå°±å¯ä»¥äº†ã€‚

![087b3d4160fc33203366856a4ec3bb5d](https://cdn.pkmer.cn/images/202310052308178.png!pkmer)

### Zotero to Excalidraw è„šæœ¬

è¯¥è„šæœ¬çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯é€šè¿‡æ‹–æ‹½çš„æ–‡æœ¬ï¼Œå®šä½åˆ°å›¾ç‰‡åï¼Œä»è€Œå¤åˆ¶è¯¥å›¾ç‰‡åˆ° OB çš„ç¬”è®°åº“ä¸­ï¼Œå¹¶å¯¹æ‹–æ‹½çš„æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œå»é™¤å¤šä½™çš„ç©ºæ ¼ä»¥åŠå…¨è§’è½¬åŠè§’ï¼Œæ‹†åˆ†ä¸º zotero_txtã€zotero_authorã€zotero_linkã€zotero_commentã€zotero_image è¿™ 5 ä¸ªæ–‡æœ¬ï¼Œè‡ªå®šä¹‰ç»„åˆï¼š

- å¦‚æœæ‹–æ‹½æ–‡æœ¬åŒ…å« "zotero://" åˆ™è¿›è¡Œæ‹†åˆ†ç»„åˆï¼Œå¦åˆ™åªå¯¹æ–‡æœ¬è¿›è¡Œæ ¼å¼åŒ–å¤„ç†
	- åˆ¤æ–­ zotero_txt æ˜¯å¦åŒ…å«æ–‡æœ¬ï¼Ÿ
		- Trueï¼šä¸ºæ–‡æœ¬æ ‡æ³¨ï¼Œç»„åˆæ–‡æœ¬ä¸ºéœ€è¦çš„æ ¼å¼
			- åˆ¤æ–­ zotero_commentã€zotero_author æ˜¯å¦åŒ…å«æ–‡æœ¬ï¼Ÿ
				- Trueï¼šåŒ…å«æ–‡æœ¬ï¼Œå³æ·»åŠ 
				- Falseï¼šä¸ºç©ºå€¼
			- ç»„åˆ zotero_txtã€zotero_authorã€zotero_comment
			- æ·»åŠ ç»„åˆæ–‡æœ¬å¹¶å¸¦æœ‰å›é“¾ zotero_link åˆ° Excalidraw ç”»æ¿
		- Falseï¼šä¸ºå›¾ç‰‡æ ‡æ³¨
			- é€šè¿‡ match_zotero_image æ¥å›¾ç‰‡å zotero_image
				- å¤åˆ¶ Zotero çš„å›¾ç‰‡åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
					- ç­‰å¾… 0.2 ç§’æ¥å¤åˆ¶æ–‡ä»¶
			- æ·»åŠ å›¾ç‰‡å¹¶å¸¦æœ‰å›é“¾ zotero_link åˆ° Excalidraw ç”»æ¿

> [!tip]+ å¦‚æœä½ æ˜¯æ‹–æ‹½æ›¿ä»–æ–‡æœ¬ï¼Œè¯¥è„šæœ¬å¯ä»¥å¸®ä½ æ ¼å¼åŒ–å¤„ç†ä¸€ä¸‹çš„

```javascript
function processText(text) {
    // æ›¿æ¢è‹±æ–‡ä¹‹é—´çš„å¤šä¸ªç©ºæ ¼ä¸ºä¸€ä¸ªç©ºæ ¼
    text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');
    // åˆ é™¤ä¸­æ–‡ä¹‹é—´çš„ç©ºæ ¼
    text = text.replace(/([\u4e00-\u9fa5])\s+([\u4e00-\u9fa5])/g, '$1$2');
    text = text.replace(/([\u4e00-\u9fa5])\s+/g, '$1');
    text = text.replace(/\s+([\u4e00-\u9fa5])/g, '$1');
    // å°†å…¨è§’å­—ç¬¦è½¬æ¢ä¸ºåŠè§’å­—ç¬¦
    text = text.replace(/[\uFF01-\uFF5E]/g, function (match) { return String.fromCharCode(match.charCodeAt(0) - 65248); });

    // // åœ¨ä¸­è‹±æ–‡ä¹‹é—´æ·»åŠ ç©ºæ ¼ï¼Œç”±äºExcalidrawä¸­ä¸­è‹±æ–‡æ·»åŠ ç©ºæ ¼ä¼šå¯¼è‡´æ¢è¡Œï¼Œæ‰€ä»¥ä¸æ¨èå¤„ç†
    // text = text.replace(/([\u4e00-\u9fa5])([a-zA-Z])/g, '$1 $2');
    // text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');

    return text;
}

function match_zotero_txt(text) {
    const regex = /â€œ(.*)â€ \(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_author(text) {
    const regex = /\(\[(.*\d+)]\(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_link(text) {
    const regex = /\[pdf\]\((.*)\)\)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_comment(text) {
    const regex = /\)\)([^ ].*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_image(text) {
    const regex = /annotation=(\w*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

const path = require('path');
const fs = require("fs");

let api = ea.getExcalidrawAPI();
let el = ea.targetView.containerEl.querySelectorAll(".excalidraw-wrapper")[0];

el.ondrop = async function (event) {
    console.log("ondrop");
    event.preventDefault();
    let insert_txt = event.dataTransfer.getData("Text");

    // æ¸…ç©ºåŸæœ¬æŠ•å…¥çš„æ–‡æœ¬
    event.stopPropagation();
    ea.clear();
    // æ ¼å¼åŒ–æ–‡æœ¬(å»ç©ºæ ¼ã€å…¨è§’è½¬åŠè§’)  

    insert_txt = processText(insert_txt)

    if (insert_txt.includes("zotero://")) {
        console.log("Zotero");

        zotero_txt = match_zotero_txt(insert_txt);
        zotero_author = match_zotero_author(insert_txt);
        if (zotero_author) {
            zotero_author = `(${zotero_author})`;
        };
        zotero_comment = match_zotero_comment(insert_txt);
        if (zotero_comment) {
            zotero_comment = `\n\nğŸ“ï¼š${zotero_comment}`;
        };
        zotero_link = match_zotero_link(insert_txt);

        if (zotero_txt) {
            console.log("ZoteroText");
            let id = await ea.addText(0, 0, `ğŸ“–ï¼š${zotero_txt}${zotero_author}${zotero_comment}`, { width: 600, box: true, wrapAt: 50, textAlign: "left", textVerticalAlign: "middle", box: "box" });
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        } else {
            console.log("ZoteroImage");
            zotero_image = match_zotero_image(insert_txt);
            zotero_image_name = `${zotero_image}.png`;

            // ğŸ“Œä¿®æ”¹åˆ°Zoteroçš„libraryæ–‡ä»¶å¤¹
            zotero_image_path = `D:\\Zotero\\cache\\library\\${zotero_image}.png`;
            // ğŸ“Œå®šä¹‰é™„ä»¶ä¿å­˜çš„åœ°å€ï¼Œä¿®æ”¹åˆ°ä½ å®šä¹‰çš„ç¬”è®°æ–‡ä»¶å¤¹
            let Obsidian_image_Path = `D:\\PandaNotes\\Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨\\ZoteroImages\\${zotero_image}.png`

            // å¤åˆ¶zoteroçš„å›¾ç‰‡åˆ°Obsidiançš„ç¬”è®°åº“
            fs.copyFileSync(zotero_image_path, Obsidian_image_Path);

            await new Promise((resolve) => setTimeout(resolve, 300)); // æš‚åœ0.3ç§’ï¼Œç­‰å¾…å¤åˆ¶æ–‡ä»¶çš„è¿‡ç¨‹

            let id = await ea.addImage(0, 0, zotero_image_name);
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        };

    } else {
        let id = await ea.addText(0, 0, `${insert_txt} `, { width: 400, box: true, wrapAt: 50, textAlign: "left", textVerticalAlign: "middle", box: "box" });
        let el = ea.getElement(id);
        await ea.addElementsToView(true, false, false);
        if (ea.targetView.draginfoDiv) {
            document.body.removeChild(ea.targetView.draginfoDiv);
            delete ea.targetView.draginfoDiv;
        };

    };
};


```
