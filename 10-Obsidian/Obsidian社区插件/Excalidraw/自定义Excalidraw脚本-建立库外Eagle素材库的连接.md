---
uid: 20231014173618
title: è‡ªå®šä¹‰ Excalidraw è„šæœ¬-å»ºç«‹åº“å¤– Eagle ç´ æåº“çš„è¿æ¥
tags: [Eagle, Excalidraw, å·¥ä½œæµ, å·¥ä½œæµæ­å»º]
description: è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - å»ºç«‹åº“å¤– Eagle ç´ æåº“çš„è¿æ¥
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20231020215808
---

# è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - å»ºç«‹åº“å¤– Eagle ç´ æåº“çš„è¿æ¥

![](https://cdn.pkmer.cn/images/202310202158767.png!pkmer)

> [!caution]+ æ¸©é¦¨æé†’
> è¿™ä¸ªè„šæœ¬æ˜¯ä½œç”¨åœ¨ Obsidian ç¬”è®°åº“å¤–çš„ Eagle åº“ï¼ŒEagle åœ¨å¯¼å…¥æ–‡ä»¶æ—¶ä¼šåˆ›å»ºå¾ˆå¤šå…¶ä»–æ•°æ®æ–‡ä»¶ï¼Œå¹¶ä¸é€‚åº”äºåœ¨ Obsidian ä¸­å»ºç«‹ï¼Œå¯ä»¥å°è¯•ç”¨ Billfish ç®¡ç† Obsidian å†…éƒ¨çš„å›¾ç‰‡ã€‚
>
> è¿™è„šæœ¬è”åŠ¨ Obsidian ç¬”è®°å¤–çš„å¥½å¤„å°±æ˜¯å½“ä½ åˆ é™¤ Eagle åº“ä¸­ç´ ææ—¶ (ç´ æåº“å®šæœŸæ•´ç†)ï¼ŒObsidian çš„å†…éƒ¨ç¬”è®°å¹¶ä¸å—å½±å“ï¼Œè€Œä¸” Eagle ä½œä¸ºç´ æç®¡ç†å™¨éå¸¸ä¼˜ç§€ï¼Œå¯ä»¥å¿«é€Ÿé¢„è§ˆå’Œç¼–è¾‘å›¾ç‰‡ï¼Œç®¡ç†å¾ˆå¤šç±»å‹çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ç”¨æµè§ˆå™¨æ‹“å±•æ’ä»¶å‰ªè—ç½‘é¡µï¼Œæ‰¹é‡æ”¶é›†ç½‘é¡µç”»æ¿æˆ–è€…å›¾ç‰‡ï¼Œä»¥å›¾æœå›¾ï¼Œç”¨æ ‡ç­¾å’Œæ ‡æ˜Ÿç®¡ç†æ–‡ä»¶ç­‰ç­‰ï¼Œå…·ä½“åŠŸèƒ½å¯ä»¥çœ‹çœ‹ç›¸å…³ä»‹ç»ã€‚

è¿™ä¸ªè„šæœ¬åœ¨ [ç¡¬æ ¸å·¥ä½œæµï¼šå®ç°ä»¥å›¾æœå›¾]( https://pkmer.cn/show/20230925114907 ) ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œè¿™é‡Œå°±å•ç‹¬æå‡ºæ¥ï¼Œè„šæœ¬çš„åˆå§‹ç›®çš„æ˜¯ä¸ºäº†å»ºç«‹å¯¹ PDF çš„å›¾ç‰‡åšç¬”è®°æ—¶ï¼ŒåŒæ—¶ä¿ç•™å›¾ç‰‡çš„å›é“¾æ¥å®šä½åˆ°å…·ä½“çš„ PDF æ‰€åœ¨çš„é¡µé¢ï¼Œå…¶ä¸­æ¶‰åŠåˆ°äº†ä¸€äº› PDF æå–å›¾ç‰‡çš„æ“ä½œã€‚

## åŠŸèƒ½æ¼”ç¤º

è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡æ‹–æ‹½å°† Eagle ä¸­ç´ ææ‹–å…¥ Excalidraw ç”»æ¿ä¸­æ—¶ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶ç´ æåˆ° Obsidian ç¬”è®°åº“ä¸­ï¼ŒåŒæ—¶è¯»å– Eagle ç´ ææ–‡ä»¶ä¸‹çš„ metadata.json æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œå°†å­˜å‚¨çš„ url è¿æ¥éšç€ç´ æåµŒå…¥åˆ° Excalidraw ç”»æ¿ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥è®©å­˜æ”¾çš„å›¾ç‰‡ã€HTMLã€PDFã€PPT ç­‰ç´ æåµŒå…¥åˆ° Excalidraw ç”»æ¿åŒæ—¶å¯ä»¥æ‰“å¼€å¯¹åº”çš„å¤–éƒ¨é“¾æ¥ã€‚

<iframe src="https://player.bilibili.com/player.html?aid=234651352&bvid=BV14841167do&cid=1232824646&page=1&autoplay=false" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="80%" height="500"> </iframe>


### é’ˆå¯¹ Office å’Œ PDF çš„åµŒå…¥

> [!tip]+ é’ˆå¯¹ Office ä¸‰ä»¶å¥—å’Œ PDF çš„ä¼˜åŒ–
> å¦‚æœåµŒå…¥çš„æ˜¯ Office ä¸‰ä»¶å¥—æˆ–è€… PDF çš„è¯ï¼Œä¼šå‡ºç°å¼¹çª—é€‰æ‹©æ’å…¥ç¼©ç•¥å›¾è¿˜æ˜¯é“¾æ¥ï¼šç¡®å®šåˆ™æ’å…¥ç¼©ç•¥å›¾é™„åŠ æ–‡ä»¶å›é“¾ï¼Œå–æ¶ˆåˆ™åªæ’å…¥è¿æ¥ï¼š
> ![](https://cdn.pkmer.cn/images/202310202201169.png!pkmer)

### é€šè¿‡å›¾ç‰‡è·³è½¬ Eagle åŸæ–‡ä»¶

> [!tip]+ Eagle çš„å¤–éƒ¨å›é“¾
> Eagle ä¹Ÿå­˜åœ¨å¤–éƒ¨é“¾æ¥ï¼Œé»˜è®¤ä¸º `eagle://item/{æ–‡ä»¶å}`ï¼Œæ–‡ä»¶ä¼šåœ¨ Eagle ä¸­æ‰“å¼€ã€‚
> æ•…å½“ä½ é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ—¶ï¼Œå†æ¬¡å•å‡»è¿™ä¸ªè„šæœ¬ï¼Œå°±ä¼šåœ¨ Eagle ä¸­æ‰“å¼€è¿™ä¸ªå›¾ç‰‡ã€‚
> ![](https://cdn.pkmer.cn/images/202310202201951.gif)

## OpenSelectImage è„šæœ¬

> [!tip]+ OpenSelectImage
> é»˜è®¤è½¯ä»¶æ‰“å¼€ç”»æ¿ä¸­é€‰ä¸­çš„å›¾ç‰‡ï¼Œé€‚ç”¨äºå½“æ‚¨æƒ³ç”¨é»˜è®¤è½¯ä»¶ç¼–è¾‘ç¬”è®°ç”»æ¿ä¸­çš„å›¾ç‰‡æ—¶ï¼Œé‡‡ç”¨çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ã€‚
> ![](https://cdn.pkmer.cn/images/202310202201572.png!pkmer)

![](https://cdn.pkmer.cn/images/202310202201415.gif)

```JavaScript
await ea.addElementsToView(); //to ensure all images are saved into the file
const { exec } = require('child_process');

const img = ea.getViewSelectedElements().filter(el => el.type === "image");
if (img.length === 0) {
  new Notice("No image is selected");
  return;
}

for (i of img) {
  const currentPath = ea.plugin.filesMaster.get(i.fileId).path;
  const file = app.vault.getAbstractFileByPath(currentPath);
  if (!file) {
    new Notice("Can't find file: " + currentPath);
    continue;
  }
  const pathNoExtension = file.path.substring(0, file.path.length - file.extension.length - 1);
  let fileName = file.path;
  let fileBasePath = file.vault.adapter.basePath;
  let filePath = `${fileBasePath}/${fileName}`

  // ä½¿ç”¨é»˜è®¤åº”ç”¨æ‰“å¼€æ–‡ä»¶
  exec(`start "" "${filePath}"`, (error, stdout, stderr) => {
    if (error) {
      console.error(`æ‰“å¼€æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`);
      return;
    }
    if (stderr) {
      console.error(`æ‰“å¼€æ–‡ä»¶æ—¶å‡ºé”™: ${stderr}`);
      return;
    }
    console.log(`æ–‡ä»¶å·²æˆåŠŸæ‰“å¼€`);
  });
}
```

### ä¿å­˜ä¸º md æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

ä¿®æ”¹å®Œè·¯å¾„åå°†ä¸‹é¢ä»£ç ä¿å­˜ä¸º md æ–‡ä»¶ï¼Œä¿®æ”¹æ”¾å…¥ Excalidraw æŒ‡å®šçš„ Scripts çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ Excalidraw çš„ç”»æ¿ä¸­çš„å·¥å…·é¢æ¿ä¸­å°±ä¼šå‡ºç°ä¸€ä¸ªé½¿è½®æŒ‰é’®ï¼Œéœ€è¦æ—¶ç‚¹å‡»è¿è¡Œå°±å¯ä»¥äº†ã€‚

![](https://cdn.pkmer.cn/images/202310202201799.png!pkmer)

## EagleToExcalidraw è„šæœ¬

åŒæ ·éœ€è¦ä¿å­˜ä¸º md æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

> [!caution]+ éœ€è¦ä¿®æ”¹çš„è·¯å¾„ (`${file_name}` å’Œ `${folder}` ä¸ä¿®æ”¹)
> ![](https://cdn.pkmer.cn/images/202310202203076.png!pkmer)
> - ç¬¬ä¸€ä¸ªä¸º Obsidian ä¸­å­˜æ”¾ç´ æçš„è·¯å¾„ (å·²åˆ›å»ºçš„è·¯å¾„)
> - ç¬¬äºŒä¸ªä¸º Eagle çš„ç´ æ images çš„è·¯å¾„

è¯¥è„šæœ¬å¯èƒ½å¹¶ä¸é€‚åº”æ¯ä¸ªäººçš„ä¹ æƒ¯ï¼Œè¿™é‡Œåªä¾›å‚è€ƒå€Ÿé‰´ï¼Œè¯·å¤§å®¶æ ¹æ®è‡ªå·±éœ€æ±‚æ¥é€‚å½“ä¿®æ”¹ä»£ç ã€‚

```javascript
function processText(text) {
    // æ›¿æ¢è‹±æ–‡ä¹‹é—´çš„å¤šä¸ªç©ºæ ¼ä¸ºä¸€ä¸ªç©ºæ ¼
    text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');
    // åˆ é™¤ä¸­æ–‡ä¹‹é—´çš„ç©ºæ ¼
    text = text.replace(/([\u4e00-\u9fa5])\s+([\u4e00-\u9fa5])/g, '$1$2');
    text = text.replace(/([\u4e00-\u9fa5])\s+/g, '$1');
    text = text.replace(/\s+([\u4e00-\u9fa5])/g, '$1');
    // å°†å…¨è§’å­—ç¬¦è½¬æ¢ä¸ºåŠè§’å­—ç¬¦
    text = text.replace(/[\uFF01-\uFF5E]/g, function (match) { return String.fromCharCode(match.charCodeAt(0) - 65248); });

    // // åœ¨ä¸­è‹±æ–‡ä¹‹é—´æ·»åŠ ç©ºæ ¼
    // text = text.replace(/([\u4e00-\u9fa5])([a-zA-Z])/g, '$1 $2');
    // text = text.replace(/([a-zA-Z])([\u4e00-\u9fa5])/g, '$1 $2');

    return text;
}

function match_zotero_txt(text) {
    const regex = /â€œ(.*)â€ \(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_author(text) {
    const regex = /\(\[(.*\d+)]\(/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_link(text) {
    const regex = /\[pdf\]\((.*)\)\)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_comment(text) {
    const regex = /\)\)([^ ].*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

function match_zotero_image(text) {
    const regex = /annotation=(\w*)/;
    const matches = text.match(regex);
    return matches ? matches[1] : "";
}

const path = require('path');
const fs = require("fs");

let api = ea.getExcalidrawAPI();
let el = ea.targetView.containerEl.querySelectorAll(".excalidraw-wrapper")[0];

el.ondrop = async function (event) {
    console.log("ondrop");
    event.preventDefault();
    let insert_txt = event.dataTransfer.getData("Text");

    // æ¸…ç©ºåŸæœ¬æŠ•å…¥çš„æ–‡æœ¬
    event.stopPropagation();
    ea.clear();
    // æ ¼å¼åŒ–æ–‡æœ¬(å»ç©ºæ ¼ã€å…¨è§’è½¬åŠè§’)  

    insert_txt = processText(insert_txt)

    if (insert_txt.includes("zotero://")) {
        console.log("Zotero");

        zotero_txt = match_zotero_txt(insert_txt);
        zotero_author = match_zotero_author(insert_txt);
        if (zotero_author) {
            zotero_author = `(${zotero_author})`;
        };
        zotero_comment = match_zotero_comment(insert_txt);
        if (zotero_comment) {
            zotero_comment = `\n\nğŸ“ï¼š${zotero_comment}`;
        };
        zotero_link = match_zotero_link(insert_txt);

        if (zotero_txt) {
            console.log("ZoteroText");

            ea.style.strokeStyle = "solid";
            ea.style.backgroundColor = "#ffffff";
            ea.style.fillStyle = 'solid';
            ea.style.roughness = 0;
            // ea.style.roundness = { type: 3 };
            ea.style.strokeWidth = 2;
            ea.style.fontFamily = 4;
            ea.style.fontSize = 20;

            let id = await ea.addText(0, 0, `ğŸ“–ï¼š${zotero_txt}${zotero_author}${zotero_comment}`, { width: 600, box: true, wrapAt: 80, textAlign: "left", textVerticalAlign: "middle", box: "box" });
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        } else {
            console.log("ZoteroImage");
            zotero_image = match_zotero_image(insert_txt);
            zotero_image_name = `${zotero_image}.png`;

            // ğŸ“Œä¿®æ”¹åˆ°Zoteroçš„libraryæ–‡ä»¶å¤¹
            zotero_image_path = `D:\\Zotero\\cache\\library\\${zotero_image}.png`;
            // ğŸ“Œå®šä¹‰é™„ä»¶ä¿å­˜çš„åœ°å€ï¼Œä¿®æ”¹åˆ°ä½ å®šä¹‰çš„ç¬”è®°æ–‡ä»¶å¤¹
            let Obsidian_image_Path = `D:\\PandaNotes\\Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨\\ZoteroImages\\${zotero_image}.png`

            // å¤åˆ¶zoteroçš„å›¾ç‰‡åˆ°Obsidiançš„ç¬”è®°åº“
            fs.copyFileSync(zotero_image_path, Obsidian_image_Path);

            await new Promise((resolve) => setTimeout(resolve, 200)); // æš‚åœ0.2ç§’ï¼Œç­‰å¾…å¤åˆ¶æ–‡ä»¶çš„è¿‡ç¨‹

            let id = await ea.addImage(0, 0, zotero_image_name);
            let el = ea.getElement(id);
            el.link = zotero_link;
            await ea.addElementsToView(true, false, false);
            if (ea.targetView.draginfoDiv) {
                document.body.removeChild(ea.targetView.draginfoDiv);
                delete ea.targetView.draginfoDiv;
            };
        };

    } else {
        let id = await ea.addText(0, 0, `${insert_txt} `, { width: 400, box: true, wrapAt: 50, textAlign: "left", textVerticalAlign: "middle", box: "box" });
        let el = ea.getElement(id);
        await ea.addElementsToView(true, false, false);
        if (ea.targetView.draginfoDiv) {
            document.body.removeChild(ea.targetView.draginfoDiv);
            delete ea.targetView.draginfoDiv;
        };

    };
};

```
