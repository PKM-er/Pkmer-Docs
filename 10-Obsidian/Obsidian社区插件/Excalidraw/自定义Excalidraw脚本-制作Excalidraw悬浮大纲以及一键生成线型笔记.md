---
uid: 20231029232811
title: è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - åˆ¶ä½œ Excalidraw æ‚¬æµ®å¤§çº²ä»¥åŠä¸€é”®ç”Ÿæˆçº¿å‹ç¬”è®°
tags:
  - Excalidraw
  - å·¥ä½œæµ
  - å·¥ä½œæµæ­å»º
  - Excalidrawè„šæœ¬
description: æœ¬æ–‡ä»…ä»…æ˜¯ä¸€ä¸ªå°è¯•å°†Exç”»æ¿è½¬ä¸ºçº¿å‹ç¬”è®°å’Œç”Ÿæˆå¤§çº²ï¼Œä¸èƒ½ä¿è¯å¤§çº²å’Œçº¿å‹ç¬”è®°çš„æ•ˆæœè¾¾åˆ°éå¸¸å®Œç¾ï¼Œç‰¹åˆ«æ˜¯æ’åºåªæ˜¯ä»å¤§åˆ°å°çš„æ’åºï¼Œè€Œä¸æ˜¯é’ˆå¯¹åˆ—è¡¨çš„é¡ºåºæ’åºï¼Œå­˜åœ¨å¾ˆå¤šæ¼æ´ã€‚
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20231029232937
---

# è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - åˆ¶ä½œ Excalidraw æ‚¬æµ®å¤§çº²ä»¥åŠä¸€é”®ç”Ÿæˆçº¿å‹ç¬”è®°

![å°é¢ï¼šExcalidrawå¤§çº²_thumbnail](https://cdn.pkmer.cn/images/%E5%B0%81%E9%9D%A2%EF%BC%9AExcalidraw%E5%A4%A7%E7%BA%B2_thumbnail.png!pkmer)

çµæ„Ÿæ¥æºäº [ä»excalidrawè§†è§‰ç¬”è®°åˆ°obsidiançº¿æ€§è¾“å‡º](https://www.bilibili.com/video/BV1D44y1P7uD/?share_source=copy_web&vd_source=71b5851b6744265a191d3ec972be4787)ï¼Œå‚è€ƒäº†è¿™ä¸ªè§†é¢‘çš„è„šæœ¬ï¼Œæƒ³æŠŠ Excalidraw çš„ç”»æ¿å†…å®¹åˆ¶ä½œçº¿å‹ç¬”è®°ï¼Œä¸€å¼€å§‹å°è¯•æ·»åŠ ç‰¹æ®Šæ–‡æœ¬ç¼–å·æŒ‰å¤§å°æ’åºæ¥åˆ¶ä½œ Excalidraw çš„æ‚¬æµ®å¤§çº²ï¼Œåæ¥é€šè¿‡ç‰¹å®šçš„ç»„å’Œ Frame åŒºåŸŸæ¥ç”¨äºæ„å»º Excalidraw çš„è¿æ¥ï¼šåˆ† Frameã€Groupã€Link çš„è¿æ¥å½¢å¼ä¸€é”®åˆ¶ä½œçº¿å‹ç¬”è®°ï¼Œå¹¶æŠŠåµŒå…¥çš„ Frame ç¬”è®°ç»™åµŒå…¥åˆ°çº¿å‹ç¬”è®°ä¸­æ¥ï¼Œæ’é™¤çœç•¥äº†åªåŒ…å«å°‘é‡çš„å…ƒç´ çš„ Frame æˆ–è€… Group è®©ç”Ÿæˆçš„çº¿å‹ç¬”è®°æ›´åŠ ç®€æ´ã€‚

æœ¬æ–‡ä»…ä»…æ˜¯ä¸€ä¸ªå°è¯•ï¼Œä¸èƒ½ä¿è¯å¤§çº²å’Œçº¿å‹ç¬”è®°çš„æ•ˆæœè¾¾åˆ°éå¸¸å®Œç¾ï¼Œç‰¹åˆ«æ˜¯æ’åºåªæ˜¯ä»å¤§åˆ°å°çš„æ’åºï¼Œè€Œä¸æ˜¯é’ˆå¯¹åˆ—è¡¨çš„é¡ºåºæ’åºï¼Œå­˜åœ¨å¾ˆå¤šæ¼æ´ã€‚

## å‡ ä¸ªè„šæœ¬çš„æ€è·¯

### æ‚¬æµ® Excalidraw å¤§çº²è„šæœ¬ï¼šGenerateExcalidrawOutline

- ä»¥ Excalidraw å›é“¾ä¸ºä¸»ï¼š
	- æå–ç‰¹æ®Šæ–‡æœ¬ç¬¦å·çš„æ–‡æœ¬çš„ idï¼›
	- ä»¥æ–‡æœ¬ id æ„å»º frameId æˆ–è€… groupIds çš„ Excalidraw çš„å—å¼•ç”¨ï¼š
		- Excalidraw çš„å—å¼•ç”¨æœ‰ 4 ç§å½¢å¼ï¼šFrameã€Groupã€Areaã€Linkï¼š
			- Frame é“¾æ¥æ˜¯ä»¥ Frame æ¡†æ¶ä¸ºä¸»ï¼Œåœ¨ä¸€ä¸ª Frame é‡Œé¢çš„å…ƒç´ éƒ½ä¼šè¢«æ˜¾ç¤ºï¼›
			- Group åˆ™æ˜¯ä»¥ç»„ä¸ºä¸»ï¼Œåªæ˜¾ç¤ºä¸€ä¸ªåˆ†ç»„çš„å…ƒç´ ï¼›
			- Area ä¸ Groupã€Frame ç›¸ä¼¼ï¼Œä¼šæ˜¾ç¤ºè¿™ä¸ªç»„çš„åŒºåŸŸï¼Œä½†ä¸æ˜¯è¯¥ç»„çš„å…ƒç´ åœ¨è¿™ä¸ªåŒºåŸŸä¹Ÿä¼šæ˜¾ç¤ºï¼›
			- Link åˆ™åªä¼šå®šä½å¹¶æ˜¾ç¤ºè¿™ä¸€ä¸ªå…ƒç´ ã€‚
- æå–ç‰¹æ®Šæ–‡æœ¬çš„æ’åºæ–¹æ¡ˆï¼š
	- ç‰¹æ®Šæ–‡æœ¬æ ¼å¼ï¼š`#1 äºŒçº§æ ‡é¢˜1`ã€`#2.3 ä¸‰çº§æ ‡é¢˜2.3`â€¦â€¦
		- åªè¯†åˆ«ä»¥ `#` + æ•°å­— + ç©ºæ ¼ å¼€å¤´çš„æ–‡æœ¬ä¸ºæ ‡é¢˜ï¼Œå…¶ä¸­ `#2.3 æ ‡é¢˜2.3` çš„ **2** è¡¨ç¤ºé¡ºåºï¼Œå³ç¬¬ 2 è¡Œçš„åˆ—è¡¨ï¼Œ**3**è¡¨ç¤ºç¼©è¿›æ¬¡æ•°ã€‚
	- æ’åºä»¥ä»å°åˆ°å¤§çš„æ’åºï¼Œå¦‚æœå­˜åœ¨åŒçº§æ ‡é¢˜ï¼Œå¦‚ï¼š`#1.2 åŒçº§1`ã€`#1.2 åŒçº§2` åˆ™ä»¥ Y è½´ä»ä¸Šåˆ°ä¸‹ï¼ŒX è½´ä»å·¦åˆ°å³æ¥æ’åº
	- åªé€‚ç”¨äº 2ã€3 çº§æ ‡é¢˜ï¼Œä¸ç”Ÿæˆ 1 çº§æ ‡é¢˜ï¼Œ4 çº§æ ‡é¢˜åé¢æ’åºä¼šæ··ä¹±ã€‚
		- `#1 äºŒçº§æ ‡é¢˜`ã€`#2 äºŒçº§æ ‡é¢˜`ã€`#3 ä¸‰çº§æ ‡é¢˜`ã€‚
- ç”Ÿæˆé¢„è§ˆæ–‡ä»¶ Excalidraw.Outline.mdã€Excalidraw.Markdown.mdï¼›
	- Excalidraw.Outline.mdï¼šç”¨äºç”Ÿæˆå½“å‰ç”»æ¿çš„å¤§çº²ï¼Œæ¯æ¬¡è¿è¡Œä¸€æ¬¡è„šæœ¬éƒ½ä¼šåˆ·æ–°ã€‚
		- æ„å»ºå¹¶åµŒå…¥æå–çš„ EX å—å¼•ç”¨é“¾æ¥åˆ°æ–‡æ¡£
		- ä»¥åˆ—è¡¨çš„å½¢å¼æ„å»ºï¼Œæ–¹ä¾¿ä¿®æ”¹å’Œç§»åŠ¨
	- Excalidraw.Markdown.mdï¼šç”¨äºç”Ÿæˆå½“å‰ç”»æ¿çš„çº¿æ€§ç¬”è®°ï¼Œæ¯ä¸€æ¬¡å¤§çº²æ›´æ–°åéƒ½ä¼šè¿›è¡Œæ›´æ–°ã€‚
- å¤åˆ¶çº¿å‹å¤§çº²åˆ°å‰ªåˆ‡æ¿ã€‚
	- æ¯æ¬¡è¿è¡Œè„šæœ¬éƒ½ä¼šè‡ªåŠ¨å¤åˆ¶çº¿å‹åˆ—è¡¨åˆ°å‰ªåˆ‡æ¿ã€‚

> [!tip]+ åªå¤åˆ¶ä¸€ä¸ªæˆ–å¤šä¸ªå¤§çº²çš„è¿æ¥
> å¦‚æœåªæƒ³å¤åˆ¶ä¸€ä¸ªæˆ–å¤šä¸ªå¤§çº²çš„è¿æ¥å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ ‡é¢˜ç»„å†è¿è¡Œè„šæœ¬å°±åªä¼šå¤åˆ¶é€‰æ‹©çš„å¤§çº²ã€‚

```js
let settings = ea.getScriptSettings();
//set default values on first run
if (!settings["Excalidraw Outline Path"]) {
    settings = {
        "Auto Update Excalidraw Markdown": {
            value: false,
            description: "âš è‡ªåŠ¨åˆ·æ–°å·²åˆ›å»ºçš„çº¿å‹ç¬”è®°ï¼Ÿ<br>è¯·æ³¨æ„æ³¨æ„ï¼šå¯ç”¨è¿™ä¸ªè„šæœ¬ä¼šå¼ºåˆ¶è¦†ç›–çº¿å‹ç¬”è®°ï¼Œå¦‚æœ‰æ„å¤–è¯·åœ¨æ ¸å¿ƒæ’ä»¶çš„æ–‡ä»¶æ¢å¤é‡Œé¢è¿›è¡Œæ¢å¤ã€‚"
        },
        "Excalidraw Outline Path": {
            value: "Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨/Excalidrawå›¾å½¢",
            description: "Excalidraw.Outline.mdå’ŒExcalidraw.Markdown.mdçš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶å¤¹"
        },
        "Excalidraw OutLine Yaml": {
            value: "---\ncssclasses:\n  - Excalidraw-Markdown\n---\n\n",
            height: "250px",
            description: "è®¾å®šçº¿å‹å¤§çº²å’Œçº¿å‹ç¬”è®°çš„å¼€å§‹åŒºåŸŸï¼Œä¸»è¦ç”¨äºè®¾å®šYaml"
        }
    };
    ea.setScriptSettings(settings);
}
const outlineFileName = `${settings["Excalidraw Outline Path"].value}/Excalidraw.Outline.md`;
const markdownFileName = `${settings["Excalidraw Outline Path"].value}/Excalidraw.Markdown.md`;

// map = ld.plugin.filesMaster;
// è·å–ç¬”è®°çš„åŸºæœ¬è·¯å¾„å’Œç¬”è®°å
const filePath = app.workspace.getActiveFile().path;
const path = require('path');
const { off } = require('process');
const fileName = path.basename(filePath);

function copyToClipboard(extrTexts) {
    const txtArea = document.createElement('textarea');
    txtArea.value = extrTexts;
    document.body.appendChild(txtArea);
    txtArea.select();
    if (document.execCommand('copy')) {
        console.log('copy to clipboard.');
    } else {
        console.log('fail to copy.');
    }
    document.body.removeChild(txtArea);
}


const selectEls = ea.getViewSelectedElements().filter(el => el.type === "text").filter(el => /^#(\d+\.*\d*)\s([\w\W]*)/.test(el.text));
if (selectEls) {
    let titleLinks = [];
    for (i of selectEls) {
        let elText = i.text;
        let elID = i.id;
        // åªæå–æ ‡é¢˜æ–‡æœ¬çš„è¿æ¥
        let regex = /^#(\d+)\.*(\d*)\s([\w\W]*)/;
        let elOutline = elText.match(regex)[3];

        let titleLink = "";
        if (i.groupIds) {
            titleLink = `[[${fileName}#^area=${elID}|${elOutline.replace(/(\[|\])+/g, '')}]]`;
        } else {
            titleLink = `[[${fileName}#^${elID}|${elOutline.replace(/(\[|\])+/g, '')}]]`;
        }
        titleLinks.push(titleLink);
    }

    exlinks = titleLinks.join('\r\n');
    copyToClipboard(exlinks);
    if (exlinks) {
        new Notice(`ğŸ€å·²å¤åˆ¶\n${exlinks}`, 1000)
    }
}

if (!exlinks) {
    // åªæå–æ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬
    let allEls = ea.getViewElements().filter(el => el.type === "text").filter(el => /^#(\d+\.*\d*)\s([\w\W]*)/.test(el.text));
    let allEmbeddables = ea.getViewElements().filter(el => el.type === "embeddable");

    // let allGroups = ea.getViewElements().filter(el => el.type === "embeddable");

    function elementsSort(elements, key = 'y') {
        let result = elements.slice(0);
        if (key == 'text') {
            let regex = /^#(\d+\.*\d*)\s([\w\W]*)/;
            return result.sort((a, b) => Number(a[key].match(regex)[1]) - Number(b[key].match(regex)[1]));
        } else {
            return result.sort((a, b) => Number(a[key]) - Number(b[key]));
        }
    }

    // selectedEl = elementsSort(selectedEl);
    allEls = elementsSort(allEls, "x");
    allEls = elementsSort(allEls, 'y');
    allEls = elementsSort(allEls, 'text');

    allEmbeddables = elementsSort(allEmbeddables, "x");
    allEmbeddables = elementsSort(allEmbeddables, 'y');


    let titleLinks = [];
    let titleTexts = [`# [[${fileName.replace(".md", "")}]]\n`];
    let frameIds = [];

    for (i of allEls) {
        let elText = i.text;
        // let elGroupIDs = i.groupIds;
        let elID = i.id;
        // åªæå–æ ‡é¢˜æ–‡æœ¬çš„è¿æ¥
        let regex = /^#(\d+)\.*(\d*)\s([\w\W]*)/;
        let numTabs = Number((elText.match(regex)[2]));
        let elOutline = elText.match(regex)[3];
        // let elOutline = elText.replace(/^#/,'');
        let tabs = '\t'.repeat(numTabs);
        let heads = '#'.repeat(numTabs + 2);
        let titleText = "";
        let titleLink = "";
        let embedlinks = [];
        let nums = 99;

        let textComments = [];

        // æå–å¤§çº²
        if (i.frameId && !frameIds.includes(i.frameId)) {

            elID = i.frameId;

            let elComments = ea.getViewElements().filter(el => el.type === "text").filter(el => /^@\s/.test(el.text)).filter(el => el.frameId === elID);
            for (k of elComments) {
                // alert(k.text);
                textComments.push(k.text.replace(/^@\s/, ""));
            }

            frameIds.push(elID);
            titleLink = `${fileName}#^frame=${elID}`;
            for (j of allEmbeddables) {
                if (j.frameId == elID) {
                    // alert(j.link)
                    embedlinks.push(`\n!${j.link} `)
                    let objectFrame = ea.getViewElements().filter(el => el.frameId === elID);
                    nums = Number(objectFrame.map(obj => obj.id).length);
                    // alert(nums)
                } else {
                    let objectFrame = ea.getViewElements().filter(el => el.frameId === elID);
                    nums = Number(objectFrame.map(obj => obj.groupIds != null).length);
                }
            }

        } else if (i.groupIds) {
            titleLink = `${fileName}#^group=${elID}`;


            let elComments = ea.getViewElements().filter(el => el.type === "text").filter(el => /^@\s/.test(el.text)).filter(el => el.groupIds.some(groupId => i.groupIds.includes(groupId)));
            for (k of elComments) {
                // alert(k.text);
                textComments.push(k.text.replace(/^@\s/, ""));
            }

            for (j of allEmbeddables) {
                if (j.groupIds.some(groupId => i.groupIds.includes(groupId))) {
                    embedlinks.push(`\n!${j.link} `)
                    let objectFrame = ea.getViewElements().filter(el => el.groupIds.some(groupId => i.groupIds.includes(groupId)));
                    nums = Number(objectFrame.map(obj => obj.id).length);

                } else {
                    let objectFrame = ea.getViewElements().filter(el => el.groupIds.some(groupId => i.groupIds.includes(groupId)));
                    nums = Number(objectFrame.map(obj => obj.id).length);
                }

            }


        } else {
            titleLink = `${fileName}#^${elID}`;
        }

        // ç»„åˆä¸ºåˆ—è¡¨
        let listStyle = '1. ';

        // titleLinks.push(`${tabs}${listStyle}[[${titleLink}|${elOutline.replace(/(\[|\])+/g, '').split('\n')[0]}]]`);
        titleLinks.push(`${tabs}${listStyle}[[${titleLink}|${elOutline.replace(/(\[|\])+/g, '')}]]`);

        // æå–çº¿å‹æ–‡æ¡£
        // å¦‚æœframeæˆ–è€…groupé‡Œé¢åªåŒ…å«åµŒå…¥å¼æ–‡æ¡£(ä¸åŒ…å«æ–‡æœ¬)ï¼Œåˆ™é€ƒè¿‡åµŒå…¥åŒºåŸŸï¼Œç›´æ¥æ·»åŠ é“¾æ¥ï¼š
        let extrEmbedlinks = embedlinks.join('\r\n')

        let textComment = textComments.join('\n')

        if (extrEmbedlinks) {
            if (nums <= 3) {
                titleText = `${heads} ${elOutline}\n\n${extrEmbedlinks}\n${textComment}\n`;
            } else {
                titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n${extrEmbedlinks}\n${textComment}\n`;
            }
        } else if (nums <= 2) {
            titleText = `${heads} ${elOutline}\n${textComment}`;
        } else {
            titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n${textComment}\n`;
        }

        // titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n`;
        titleTexts.push(titleText);

    }

    // è¾“å‡ºå¤§çº²
    titleLinks.push('\n');
    exlinks = titleLinks.join('\r\n');

    let outlineFile = '';
    outlineFile = app.vault.getAbstractFileByPath(outlineFileName);


    // è®¾å®šä¸€äº›yamlï¼Œç‰¹åˆ«å®šä¹‰csscalsså¥½ä¿®æ”¹
    let outlineYaml = "";
    outlineYaml = settings["Excalidraw OutLine Yaml"].value;

    exlinks = outlineYaml + exlinks;

    if (outlineFile) {
        app.vault.modify(outlineFile, exlinks);
        new Notice(`âœ…Excalidrawçº¿å‹å¤§çº²æ›´æ–°`, 1000)
    } else {
        file = await app.vault.create(outlineFileName, exlinks)
        // new Notice(`åˆ›å»º${outlineFileName}`, 1000)
    }

    // çº¿å‹ç¬”è®°è¾“å…¥åˆ°å‰ªåˆ‡æ¿
    extrTexts = titleTexts.join('\r\n');
    new Notice(`ğŸ“‹çº¿å‹ç¬”è®°å·²è¾“å…¥å‰ªåˆ‡æ¿`, 3000)
    copyToClipboard(extrTexts)
    extrTexts = outlineYaml + extrTexts;

    let markdownFile = app.vault.getAbstractFileByPath(markdownFileName);

    if (markdownFile) {
        app.vault.modify(markdownFile, extrTexts);
    } else {
        file = await app.vault.create(markdownFileName, extrTexts)
    }

    let mdFileName = await ea.targetView.file.path.replace('.md', `.markdown.md`)
    let markdownFile2 = app.vault.getAbstractFileByPath(mdFileName);

    if (markdownFile2 && settings["Auto Update Excalidraw Markdown"].value) {
        app.vault.modify(markdownFile2, extrTexts);
        new Notice(`âœ…Excalidrawçº¿å‹æ–‡æ¡£æ›´æ–°`, 3000)
    }

}

```

> [!tip]+ è„šæœ¬è®¾ç½®
> ![Pasted image 20231029225430](https://cdn.pkmer.cn/images/Pasted%20image%2020231029225430.png!pkmer)

#### è¾…åŠ©è„šæœ¬ 1ï¼šOpenOutlineByHover

ç”¨äºä»¥æ‚¬æµ®é¢æ¿æ‰“å¼€å½“å‰ç”»æ¿çš„åˆ—è¡¨å¤§çº²ã€‚

- ä»¥ Hover æ‚¬æµ®é¢æ¿æ‰“å¼€ Excalidraw.Outline.md
- éœ€è¦é…åˆ [Opener æ’ä»¶](https://github.com/aidan-gibson/obsidian-opener) çš„ New Tab Default ä¼˜åŒ–ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢ç‚¹å‡»åçª—å£æ›¿æ¢
	- Opener æ’ä»¶å¹¶æ²¡æœ‰ä¸Šæ¶æ’ä»¶å¸‚åœºï¼Œå¯ä»¥ç”¨ New Tab Default æ›¿ä»£
- å¯ä»¥é…åˆ Commander æ’ä»¶åœ¨é¦–é¡µå®‰è£…è¿™ä¸ªæŒ‰é’®ï¼Œæ–¹ä¾¿è¿è¡Œ
	- ![Pasted image 20231029222947](https://cdn.pkmer.cn/images/Pasted%20image%2020231029222947.png!pkmer)

```js
let settings = ea.getScriptSettings();
//set default values on first run
if (!settings["Excalidraw Outline Path"]) {
    settings = {
        "Excalidraw Outline Path": {
            value: "Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨/Excalidrawå›¾å½¢",
            description: "Excalidraw.Outline.mdå’ŒExcalidraw.Markdown.mdçš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶å¤¹"
        }
    };
    ea.setScriptSettings(settings);
}
const outlineFileName = `${settings["Excalidraw Outline Path"].value}/Excalidraw.Outline.md`;

let outlineFile = app.vault.getAbstractFileByPath(outlineFileName);

let newLeaf = app.plugins.plugins["obsidian-hover-editor"].spawnPopover(undefined, () => this.app.workspace.setActiveLeaf(newLeaf, false, true));
newLeaf.openFile(outlineFile);
```

å¯ä»¥ç›´æ¥ä¿®æ”¹è„šæœ¬çš„ç”Ÿæˆ Outline çš„ç›¸å¯¹è·¯å¾„ï¼Œæˆ–è€…å•å‡»è¿è¡Œä¸€æ¬¡ååœ¨ Excalidraw æ’ä»¶è®¾ç½®é‡Œé¢ä¿®æ”¹ã€‚

#### è¾…åŠ©è„šæœ¬ 2ï¼šOpenMarkdown

åœ¨ä¾§è¾¹æ‰“å¼€çº¿å‹ç¬”è®°ï¼Œå¦‚æœå½“å‰ç¬”è®°å­˜åœ¨çº¿å‹ç¬”è®°åˆ™å¯ä»¥é€‰æ‹©æ€§æ‰“å¼€çº¿å‹ç¬”è®°æˆ–è€… Excalidraw.Markdown.md é¢„è§ˆç¬”è®°ã€‚

> [!tip]+ Excalidraw.Markdown.md æ–‡ä»¶å­˜æ”¾è·¯å¾„
> Excalidraw.Markdown.md æ–‡ä»¶æœ€å¥½å­˜æ”¾åœ¨ Excalidraw çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„æ–‡ä»¶å¤¹ä¸ä¼šè¢« Obsidian æ£€æµ‹åŒé“¾ï¼š
> ![Pasted image 20231029223449](https://cdn.pkmer.cn/images/Pasted%20image%2020231029223449.png!pkmer)
>
> > å¯ä»¥é…åˆ Commander æ’ä»¶åœ¨é¦–é¡µå®‰è£…è¿™ä¸ªæŒ‰é’®ï¼Œæ–¹ä¾¿è¿è¡Œï¼š
> > ![Pasted image 20231029230546](https://cdn.pkmer.cn/images/Pasted%20image%2020231029230546.png!pkmer)

```js
let settings = ea.getScriptSettings();
//set default values on first run
if (!settings["Excalidraw Outline Path"]) {
    settings = {
        "Excalidraw Outline Path": {
            value: "Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨/Excalidrawå›¾å½¢",
            description: "Excalidraw.Outline.mdå’ŒExcalidraw.Markdown.mdçš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶å¤¹"
        }
    };
    ea.setScriptSettings(settings);
}

const markdownFileName = `${settings["Excalidraw Outline Path"].value}/Excalidraw.Markdown.md`;

let mdFileName = await ea.targetView.file.path.replace('.md', `.markdown.md`)
let markdownFile2 = app.vault.getAbstractFileByPath(mdFileName);

let outlineFile = '';
let openFile = null;
if (markdownFile2) openFile = confirm("æ£€æµ‹å·²å­˜åœ¨çº¿å‹ç¬”è®°ï¼Œæ˜¯å¦æ‰“å¼€ï¼Ÿ");

if (openFile) {
    outlineFile = app.vault.getAbstractFileByPath(mdFileName);
} else {

    outlineFile = app.vault.getAbstractFileByPath(markdownFileName);
}

ea.openFileInNewOrAdjacentLeaf(outlineFile);
```

å¯ä»¥ç›´æ¥ä¿®æ”¹è„šæœ¬çš„ç”Ÿæˆ Excalidraw Outline Path çš„ç›¸å¯¹è·¯å¾„ï¼Œæˆ–è€…å•å‡»è¿è¡Œä¸€æ¬¡ååœ¨ Excalidraw æ’ä»¶è®¾ç½®é‡Œé¢ä¿®æ”¹ã€‚

### é€šè¿‡åˆ—è¡¨æ¥è°ƒæ•´çº¿å‹ç¬”è®°é¡ºåºï¼šModOutlineByList

å€ŸåŠ© Outliner æ’ä»¶å¯ä»¥ä¾¿æ·è°ƒæ•´çº¿å‹åˆ—è¡¨ï¼Œåœ¨ GenerateExcalidrawOutline è„šæœ¬ä¸­ä¼šç”Ÿæˆ Excalidraw.Ouline çš„çº¿å‹å¤§çº²ç¬”è®°ï¼Œè¯¥è„šæœ¬çš„ä½œç”¨æ˜¯é€šè¿‡ Outline çš„ä¿®æ”¹ (å¯ä»¥æ›´æ”¹æ–‡å­—å’Œåˆ—è¡¨é¡ºåºå’Œç¼©è¿›) æ¥åé¦ˆç»™çº¿å‹ç¬”è®°ï¼Œç­‰å¾…è°ƒæ•´å¥½åï¼Œè¿è¡Œæ”¹è„šæœ¬å°±å¯ä»¥è°ƒæ•´ç¼–å·å’Œæ–‡å­—äº†ã€‚

```js
let settings = ea.getScriptSettings();
//set default values on first run
if (!settings["Excalidraw Outline Path"]) {
    settings = {
        "Excalidraw Outline Path": {
            value: "Y-å›¾å½¢æ–‡ä»¶å­˜å‚¨/Excalidrawå›¾å½¢",
            description: "Excalidraw.Outline.mdå’ŒExcalidraw.Markdown.mdçš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶å¤¹"
        }
    };
    ea.setScriptSettings(settings);
}
const outlineFileName = `${settings["Excalidraw Outline Path"].value}/Excalidraw.Outline.md`;

const fs = require('fs');
// è·å–åº“çš„åŸºæœ¬è·¯å¾„
const basePath = (app.vault.adapter).getBasePath()
// alert(basePath)
const outlineFilePath = `${basePath}\\${outlineFileName}`

// è·å–ç¬”è®°çš„åŸºæœ¬è·¯å¾„å’Œç¬”è®°å
const filePath = app.workspace.getActiveFile().path;
const path = require('path');
const fileName = path.basename(filePath);
// alert(fileName)
const api = ea.getExcalidrawAPI();
const selectedEls = ea.getViewElements().filter(el => el.type === "text").filter(el => /^#(\d+\.*\d*)\s([\w\W]*)/.test(el.text));
ids = [selectedEls.id]


fs.readFile(outlineFilePath, 'utf8', (err, data) => {
    if (err) {
        alert(err);
        return;
    }
    // let modOutline = confirm("ç¡®è®¤ä¿®æ”¹å¤§çº²ï¼Ÿ");
    
    // if (modOutline) {
    const lines = data.split('\n');
    const regex = new RegExp(`${fileName}`);
    let j = 0;
    for (let i = 0; i < lines.length; i++) {
        // if (lines[i].includes(`- [[${fileName}#`)) {
        if (regex.test(lines[i])) {
            let regex = /(\t*)[-\d.]+ \[\[.*\.md#\^(\w+)=([a-zA-Z0-9-_]+)\|([\w\W]*?)]]/;
            let tabs = lines[i].match(regex)[1];
            let numTabs = 0;
            if (tabs) {
                numTabs = tabs.match(/\t/g).length;
            }
            if (numTabs == 0) {
                j = j + 1; // ç¼–å·ä¸Šä¸‹é¡ºåº
            }
            let elLinkStyle = lines[i].match(regex)[2];
            let elID = lines[i].match(regex)[3];
            let elText = lines[i].match(regex)[4]

            // alert(`ç¬¬${j}è¡Œï¼š${elID} ${numTabs} ${elLinkStyle} ${elText}`);
            // åªæå–æ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬
            if (elLinkStyle == 'frame') {
                // alert(`ç¬¬${j}è¡Œï¼š${elID} ${numTabs} ${elLinkStyle} ${elText}`);
                for (selectedEl of selectedEls) {
                    if (selectedEl.frameId == elID) {
                        // alert("åŒ¹é…æˆåŠŸ")
                        let modText = '';
                        if (numTabs == '0') {
                            modText = `#${j} ${elText}`;
                        } else {
                            modText = `#${j}.${numTabs} ${elText}`;
                        }
                        selectedEl.originalText = selectedEl.rawText = selectedEl.text = modText;
                        // alert(modText);
                        ea.copyViewElementsToEAforEditing([selectedEl]);
                        ea.addElementsToView(false, false);
                    }
                }
            } else {
                for (selectedEl of selectedEls) {
                    if (selectedEl.id == elID) {
                        // alert("åŒ¹é…æˆåŠŸ")
                        let modText = '';
                        if (numTabs == '0') {
                            modText = `#${j} ${elText}`;
                        } else {
                            modText = `#${j}.${numTabs} ${elText}`;
                        }
                        selectedEl.originalText = selectedEl.rawText = selectedEl.text = modText;
                        // alert(modText);
                        ea.copyViewElementsToEAforEditing([selectedEl]);
                        ea.addElementsToView(false, false);
                    }
                }
            }
            

            continue;
        }
    }

});

// ea.copyViewElementsToEAforEditing([selectedEls]);
ea.addElementsToView(true,false, false);
new Notice(`ç”»æ¿å¤§çº²å·²æ›´æ–°`, 2000)
```

### ä¸€é”®ç”Ÿæˆçº¿å‹ç¬”è®°çš„è„šæœ¬ï¼šCreateAndUpdateLinearNotes

è¿™æ˜¯é…åˆçº¿å‹å¤§çº²çš„æˆ–è€…é¢„è§ˆ Excalidraw.Markdown.md ç¬”è®°ç›´æ¥ç”Ÿæˆçº¿å‹ç¬”è®°ï¼Œå®é™…ä¸Šç”Ÿæˆçš„çº¿å‹ç¬”è®°å’Œ Excalidraw.Markdown.md ç¬”è®°ä¸€æ¨¡ä¸€æ ·ï¼Œç”Ÿæˆä»¥å½“å‰ç”»æ¿æ–‡ä»¶åä¸€æ ·ä»¥.markdown.md ç»“å°¾çš„çº¿å‹ç¬”è®°åœ¨è¯¥ç”»æ¿è·¯å¾„ä¸‹ã€‚

- å°±æ˜¯ä¿å­˜ Excalidraw.Markdown.md åˆ°å…·ä½“çš„çº¿å‹ç¬”è®°ï¼ŒExcalidraw.Markdown.md ä¼šéšç€ç”»æ¿å˜åŒ–è€Œå˜åŒ–ï¼Œè€Œ CreateAndUpdateLinearNotes åˆ™æ˜¯è½¬æ¢æˆçº¿å‹ç¬”è®°ã€‚
- åœ¨ GenerateExcalidrawOutline è„šæœ¬è®¾ç½®ä¸­ï¼Œå¦‚æœå¼€å¯è‡ªåŠ¨æ›´æ–°çš„è®¾ç½®ï¼Œåˆ™æ¯ä¸€æ¬¡åˆ·æ–°å¤§çº²ï¼Œè¿™ä¸ªç¬”è®°éƒ½ä¼šè¢«åˆ·æ–°ï¼Œå¦‚æœé€‰æ‹©å…³é—­åˆ™ä¸ä¼šè¢«è¦†ç›–ï¼š
	- ![Pasted image 20231029230338](https://cdn.pkmer.cn/images/Pasted%20image%2020231029230338.png!pkmer)

```js
// è·å–ç¬”è®°çš„åŸºæœ¬è·¯å¾„å’Œç¬”è®°å
const filePath = await ea.targetView.file.path;
const path = require('path');
const fileName = path.basename(filePath);

// åªæå–æ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬
let allEls = ea.getViewElements().filter(el => el.type === "text").filter(el => /^#(\d+\.*\d*)\s([\w\W]*)/.test(el.text));
let allEmbeddables = ea.getViewElements().filter(el => el.type === "embeddable");

// let allGroups = ea.getViewElements().filter(el => el.type === "embeddable");

function elementsSort(elements, key = 'y') {
    let result = elements.slice(0);
    if (key == 'text') {
        let regex = /^#(\d+\.*\d*)\s([\w\W]*)/;
        return result.sort((a, b) => Number(a[key].match(regex)[1]) - Number(b[key].match(regex)[1]));
    } else {
        return result.sort((a, b) => Number(a[key]) - Number(b[key]));
    }
}

// selectedEl = elementsSort(selectedEl);
allEls = elementsSort(allEls, "x");
allEls = elementsSort(allEls, 'y');
allEls = elementsSort(allEls, 'text');

allEmbeddables = elementsSort(allEmbeddables, "x");
allEmbeddables = elementsSort(allEmbeddables, 'y');


let titleLinks = [];
let titleTexts = [`# [[${fileName.replace(".md", "")}]]\n`];
let frameIds = [];
for (i of allEls) {
    let elText = i.text;
    // let elGroupIDs = i.groupIds;
    let elID = i.id;
    // åªæå–æ ‡é¢˜æ–‡æœ¬çš„è¿æ¥
    let regex = /^#(\d+)\.*(\d*)\s([\w\W]*)/;
    let numTabs = Number((elText.match(regex)[2]));
    let elOutline = elText.match(regex)[3];
    // let elOutline = elText.replace(/^#/,'');
    let tabs = '\t'.repeat(numTabs);
    let heads = '#'.repeat(numTabs + 2);
    let titleText = "";
    let titleLink = "";
    let embedlinks = [];
    let nums = 99;

    // æå–å¤§çº²
    if (i.frameId && !frameIds.includes(i.frameId)) {
        elID = i.frameId;
        frameIds.push(elID);
        titleLink = `${fileName}#^frame=${elID}`;
        for (j of allEmbeddables) {
            if (j.frameId == elID) {
                // alert(j.link)
                embedlinks.push(`\n!${j.link} `)
                let objectFrame = ea.getViewElements().filter(el => el.frameId === elID);
                nums = Number(objectFrame.map(obj => obj.id).length);
                // alert(nums)
            } else {
                let objectFrame = ea.getViewElements().filter(el => el.frameId === elID);
                nums = Number(objectFrame.map(obj => obj.groupIds != null).length);
            }
        }

    } else if (i.groupIds) {
        titleLink = `${fileName}#^group=${elID}`;
        for (j of allEmbeddables) {
            if (j.groupIds.some(groupId => i.groupIds.includes(groupId))) {
                embedlinks.push(`\n!${j.link} `)

                let objectFrame = ea.getViewElements().filter(el => el.groupIds.some(groupId => i.groupIds.includes(groupId)));
                nums = Number(objectFrame.map(obj => obj.id).length);

            } else {
                let objectFrame = ea.getViewElements().filter(el => el.groupIds.some(groupId => i.groupIds.includes(groupId)));
                nums = Number(objectFrame.map(obj => obj.id).length);
            }

        }


    } else {
        titleLink = `${fileName}#^${elID}`;
    }

    // ç»„åˆä¸ºåˆ—è¡¨
    let listStyle = '1. ';
    titleLinks.push(`${tabs}${listStyle}[[${titleLink}|${elOutline.replace(/(\[|\])+/g, '')}]]`);

    // æå–çº¿å‹æ–‡æ¡£
    // å¦‚æœframeæˆ–è€…groupé‡Œé¢åªåŒ…å«åµŒå…¥å¼æ–‡æ¡£(ä¸åŒ…å«æ–‡æœ¬)ï¼Œåˆ™é€ƒè¿‡åµŒå…¥åŒºåŸŸï¼Œç›´æ¥æ·»åŠ é“¾æ¥ï¼š
    let extrEmbedlinks = embedlinks.join('\r\n')

    if (extrEmbedlinks) {
        if (nums <= 3) {
            titleText = `${heads} ${elOutline}\n${extrEmbedlinks}\n`;
        } else {
            titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n${extrEmbedlinks}\n`;
        }
    } else if (nums <= 2) {
        titleText = `${heads} ${elOutline}\n`;
    } else {
        titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n`;
    }

    // titleText = `${heads} ${elOutline}\n\n![[${titleLink}]]\n`;
    titleTexts.push(titleText);
}

// è®¾å®šä¸€äº›yamlï¼Œç‰¹åˆ«å®šä¹‰csscalsså¥½ä¿®æ”¹
let outlineYaml = "";
// outlineYaml = "---\ncssclasses:\n  - Excalidraw-Markdown\n---\n";

// çº¿å‹ç¬”è®°è¾“å…¥åˆ°æ–‡ä»¶
extrTexts = titleTexts.join('\r\n');
extrTexts = outlineYaml + extrTexts;

let mdFileName = await ea.targetView.file.path.replace('.md', `.markdown.md`)
const mdFileBaseName = path.basename(mdFileName);
let markdownFile = app.vault.getAbstractFileByPath(mdFileName);

if (markdownFile) {
    app.vault.modify(markdownFile, extrTexts);
    new Notice(`âœ…Excalidrawçº¿å‹æ–‡æ¡£æ›´æ–°`, 1000);
} else {
    let confirmCreat = confirm(`âš ç¡®è®¤ç”Ÿæˆçº¿å‹ç¬”è®°ï¼š\n\n${mdFileBaseName}`);
    if (confirmCreat) {
        file = await app.vault.create(mdFileName, extrTexts);
        new Notice(`âœ…Excalidrawçº¿å‹æ–‡æ¡£å·²æ›´æ–°`, 1000)
    }
}
```

## Excalidraw çš„åµŒå…¥å›¾ç‰‡è®¾ç½®

![Pasted image 20231029215820](https://cdn.pkmer.cn/images/Pasted%20image%2020231029215820.png!pkmer)

> [!tip]+ æ¨èæ¨¡å¼
> å¦‚æœç”µè„‘æ€§èƒ½ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œå»ºè®®åœ¨ç¼–è¾‘æˆ–è€…å¿«é€ŸæŸ¥çœ‹çš„æ—¶å€™é‡‡ç”¨ PNG æ¨¡å¼ï¼Œå½“ä½ éœ€è¦çœŸæ­£çš„å¤åˆ¶æ–‡æœ¬çš„è¯ï¼Œå†å»åˆ‡æ¢ SVG æ ¼å¼ã€‚

## æ€»ç»“

æ€»ä½“é…ç½®ä¸‹æ¥éå¸¸éº»çƒ¦ï¼Œç”»æ¿è½¬æ¢çš„çº¿å‹ç¬”è®°ä¹Ÿä¸å°½å®Œç¾ï¼Œä¸è¿‡è¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªç®€å•çš„å°è¯•ï¼Œä»Šåæœ‰æ”¹è¿›çš„åœ°æ–¹ä¼šé€æ­¥å®Œå–„ã€‚
