---
uid: 20240828131108
title: è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - æŠ å›¾è„šæœ¬ remove.bg
tags: [å›¾ç‰‡å¤„ç†, Excalidrawè„šæœ¬]
description: åˆ©ç”¨ Remove.bg çš„ API åœ¨Excalidrawç»˜å›¾è¿‡ç¨‹ä¸­è‡ªåŠ¨å»é™¤å›¾åƒèƒŒæ™¯
author: ç†ŠçŒ«åˆ«ç†¬å¤œ
type: other
draft: false
editable: false
modified: 20240828131331
---

# è‡ªå®šä¹‰ Excalidraw è„šæœ¬ - æŠ å›¾è„šæœ¬ remove.bg

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311688.gif)

[Remove.bg](https://www.remove.bg) æ˜¯ä¸€æ¬¾åœ¨çº¿å›¾åƒå¤„ç†å·¥å…·ï¼Œä¸“æ³¨äºå¿«é€Ÿã€é«˜æ•ˆåœ°å»é™¤å›¾åƒèƒŒæ™¯ã€‚å®ƒåˆ©ç”¨å…ˆè¿›çš„äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œè‡ªåŠ¨è¯†åˆ«å›¾åƒä¸­çš„å‰æ™¯å’ŒèƒŒæ™¯ï¼Œç”¨æˆ·åªéœ€ä¸Šä¼ å›¾åƒï¼Œç³»ç»Ÿä¾¿èƒ½åœ¨å‡ ç§’é’Ÿå†…ç”Ÿæˆæ¸…æ™°çš„æ— èƒŒæ™¯å›¾åƒã€‚

åœ¨ Excalidraw ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ Remove.bg çš„ API åœ¨ç»˜å›¾è¿‡ç¨‹ä¸­è‡ªåŠ¨å»é™¤å›¾åƒèƒŒæ™¯ï¼Œç‰¹åˆ«é€‚ç”¨äºäººç‰©è§’è‰²æå–ã€‚

Demoï¼š

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311355.gif!pkmer)

## è®¾ç½® API Key

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311951.png!pkmer)

éœ€è¦ä» [Background Removal API â€“ remove.bg](https://www.remove.bg/zh/api) ä¸­è·å– Remove.bg çš„ API key ç”¨äºæ­¤è„šæœ¬çš„è°ƒç”¨ã€‚

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311619.png!pkmer)

é¦–æ¬¡è¿è¡Œæ­¤è„šæœ¬ä¼šå¼¹å‡º API key çš„è¾“å…¥æ¡†ä»¥åŠè‡ªåŠ¨æ‰“å¼€ [Background Removal API â€“ remove.bg](https://www.remove.bg/zh/api) ç½‘å€ï¼Œä¹Ÿå¯ä»¥åœ¨ Excalidraw æ’ä»¶è®¾ç½®çš„ `Settings for installed Scripts` ä¸­æ‰‹åŠ¨ä¿®æ”¹ã€‚

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311386.png!pkmer)

> [!tip]
> å¦‚æœè®¾ç½®åï¼Œä¸é€‰ä¸­å›¾ç‰‡ä¹Ÿä¼šå¼¹å‡ºæ­¤è¾“å…¥æ¡†

## æ”¯æŒæ ¼å¼

æ”¯æŒæ ¼å¼æœ‰ JPG å’Œ PNGï¼Œè¯·æ³¨æ„ï¼Œ**ä¸æ”¯æŒ 10 å…†åƒç´ ä»¥ä¸Šçš„ PNG å›¾åƒ**ã€‚å¦‚æœæ‚¨éœ€è¦è¯¥å°ºå¯¸çš„å›¾åƒå…·æœ‰é€æ˜åº¦ï¼Œå¦‚æœæ‚¨ä¸éœ€è¦é€æ˜åˆ™ä¸ºç™½è‰²èƒŒæ™¯ã€‚

## å‚æ•°

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311959.png!pkmer)

### å°ºå¯¸ (Size)

æœ€å¤§è¾“å‡ºå›¾åƒåˆ†è¾¨ç‡ï¼Œ**size**è®¾ç½®ä¸ºä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š

| å‚æ•°        | è¯´æ˜                                                                                |
| --------- | --------------------------------------------------------------------------------- |
| `auto`    | ä½¿ç”¨æœ€é«˜å¯ç”¨åˆ†è¾¨ç‡ï¼Œé«˜è¾¾ 25 å…†åƒç´ ï¼ˆä¾‹å¦‚ 6250Ã—4000ï¼‰ï¼ˆåŸºäºå›¾åƒå¤§å°å’Œå¯ç”¨ç§¯åˆ†ï¼‰                                    |
| `preview` | å°†å›¾åƒå¤§å°è°ƒæ•´ä¸º 0.25 å…†åƒç´ ï¼ˆä¾‹å¦‚ 625Ã—400 åƒç´ ï¼‰                                                  |
| `full`    | ä½¿ç”¨åŸå§‹å›¾åƒåˆ†è¾¨ç‡ï¼Œ JPG æ ¼å¼æœ€é«˜å¯è¾¾ 25 å…†åƒç´ ï¼ˆä¾‹å¦‚ 6250Ã—4000ï¼‰ï¼ŒPNG æ ¼å¼æœ€é«˜å¯è¾¾ 10 å…†åƒç´ ï¼ˆä¾‹å¦‚ 4000Ã—2500ï¼‰        |

### ç±»å‹ (Type)

æ£€æµ‹æˆ–è®¾ç½®å‰æ™¯**ç±»å‹**ï¼Œå»ºè®®ä½¿ç”¨**type = auto**è‡ªåŠ¨æ£€æµ‹å‰æ™¯çš„**ç±»å‹**ã€‚

![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311703.png!pkmer)

**type**è®¾ç½®ä¸ºä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š

|        å‚æ•°        | è¯´æ˜   |
|:--------------: | ---- |
|      `auto`      | è‡ªåŠ¨æ£€æµ‹ |
|      `car`       | æ±½è½¦   |
|    `product`     | äº§å“   |
|     `person`     | äºº    |
|     `animal`     | åŠ¨ç‰©   |
|    `graphic`     | å›¾å½¢   |
| `transportation` | äº¤é€š   |

### ä½ç½® (Position)

æŠ å‡ºæ¥çš„å›¾ç‰‡ä½äºåŸå§‹å›¾ç‰‡çš„ä½ç½®ï¼š

| å‚æ•°  | è¯´æ˜           | ç¤ºæ„                                                                                                      |
| :-: | ------------ | ------------------------------------------------------------------------------------------------------- |
| ç›¸é‚»  | åœ¨åŸå§‹å›¾ç‰‡å³ä¾§æ˜¾ç¤º    | ![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311133.png!pkmer)<br> |
| ç›¸åŒ  | åœ¨åŸå§‹å›¾ç‰‡çš„åŸå§‹ä½ç½®æ˜¾ç¤º | ![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281312953.gif!pkmer)<br> |
| æ›¿æ¢  | æ›¿æ¢åŸå§‹å›¾åƒ       | ![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281312974.gif!pkmer)<br> |

### é€æ˜èƒŒæ™¯

é»˜è®¤ä¸ºé€æ˜èƒŒæ™¯ï¼Œå¦‚æœä¸éœ€è¦åˆ™ä¸ºç™½åº•èƒŒæ™¯ã€‚

## è„šæœ¬å®‰è£…

å¯é€šè¿‡ Excalidraw æ’ä»¶çš„è„šæœ¬ä»£ç å— (\`\`\`excalidraw-script-install) æ¥å®‰è£…ï¼Œé‡Œé¢æ”¾çš„æ˜¯è„šæœ¬ GitHub çš„ RAW é“¾æ¥ï¼Œåœ¨ Obsidian ä¸­ä¼šæ˜¾ç¤ºä¸ºæŒ‰é’®ï¼Œè„šæœ¬æ›´æ–°ä¼šè‡ªåŠ¨æ£€æµ‹ã€‚

> ![24.08.26_è‡ªå®šä¹‰Excalidrawè„šæœ¬-æŠ å›¾è„šæœ¬remove.bg.md](https://cdn.pkmer.cn/images/202408281311462.png!pkmer)

````
```excalidraw-script-install
https://raw.githubusercontent.com/PandaNocturne/ExcalidrawScripts/master/PandaScripts/RemoveBg.md
```
````

å°†ä¸Šè¿°ä»£ç å—æ”¾åˆ°ä¸€ä¸ª **md æ–‡ä»¶**ï¼Œé˜…è¯»æ¨¡å¼ä¸‹è¯¥ä»£ç å—ä¼šæ˜¾ç¤ºä¸º <kbd>å®‰è£…è„šæœ¬</kbd>çš„æŒ‰é’®ï¼Œç‚¹å‡»å®‰è£…ä¹‹åï¼Œæ›´æ–°ä¸º<kbd>è„šæœ¬å·²æ˜¯æœ€æ–° - ç‚¹å‡»é‡æ–°å®‰è£…</kbd>ï¼Œå³å½“å‰è„šæœ¬å·²ç»å®‰è£…ï¼Œåœ¨ Excalidraw ç”»å¸ƒç•Œé¢çš„ä¾§è¾¹**Obsidian å·¥å…·é¢æ¿**ä¸­å¯ä»¥æŸ¥çœ‹ã€‚

### æºç  - ä»…ä¾›å‚è€ƒ

```js
/*
 * @Author: ç†ŠçŒ«åˆ«ç†¬å¤œ 
 * @Date: 2024-08-26 12:37:13 
 * @Last Modified by: ç†ŠçŒ«åˆ«ç†¬å¤œ
 * @Last Modified time: 2024-08-28 11:48:06
 */
let settings = ea.getScriptSettings();
if (!settings["Remove.bg API Key"]?.value) {
  // è‡ªåŠ¨æ‰“å¼€https://www.remove.bg/zh/apiç½‘ç«™
  window.open("https://www.remove.bg/zh/api", "_blank");
  const key = await utils.inputPrompt("è¯·åœ¨ script settings ä¸­è®¾ç½®Remove.bg API Key", "è¯·åœ¨https://www.remove.bg/zh/apiä¸­è·å–API Key");
  settings = {
    "Remove.bg API Key": {
      value: key || "",
      description: "è¯·åœ¨https://www.remove.bg/zh/apiä¸­è·å–API Key"
    },
  };
  ea.setScriptSettings(settings);
  return;
}

const fs = require("fs").promises;
const path = require("path");

await ea.addElementsToView();
const imgs = ea.getViewSelectedElements().filter(el => el.type === "image");
if (imgs.length === 0) {
  new Notice("No image found");

  const key = await utils.inputPrompt("Remove.bg API Key", "è¯·åœ¨https://www.remove.bg/zh/apiä¸­è·å–API Key", settings["Remove.bg API Key"].value);
  if (!key) return;

  settings = {
    "Remove.bg API Key": {
      value: key,
      description: "è¯·åœ¨https://www.remove.bg/zh/apiä¸­è·å–API Key"
    },
  };
  ea.setScriptSettings(settings);
  return;
}

const inputdata = {
  "filePath": "",
  "size": "auto",
  "type": "auto",
  "key": settings["Remove.bg API Key"].value,
  "format": "auto"
};
// å›¾ç‰‡æ¸…æ™°åº¦
const sizelist = ['auto', 'preview', 'regular', 'full'];
// æŠ å›¾ç±»å‹
const typeList = ['auto', 'car', 'product', 'person', 'animal', 'graphic', 'transportation'];
const typeList2 = ['è‡ªåŠ¨è¯†åˆ«', 'æ±½è½¦', 'ç‰©å“', 'äººåƒ', 'åŠ¨ç‰©', 'å›¾å½¢', 'äº¤é€š'];

// å›¾ç‰‡ä½ç½®
const positionList = ['ç›¸é‚»', 'ç›¸åŒ', 'æ›¿æ¢'];
let position = positionList[0];
// å›¾ç‰‡èƒŒæ™¯
let isbg = true;
// é…ç½®æŒ‰é’®
const customControls = (container) => {
  // æ·»åŠ ä¸‹æ‹‰èœå•é€‰æ‹©æ ¼å¼
  new ea.obsidian.Setting(container)
    .setName(`å¤§å°(Size)`)
    .addDropdown(dropdown => {
      sizelist.forEach((item) => {
        dropdown.addOption(item, item);
      });
      dropdown
        .setValue(sizelist[0])
        .onChange(value => {
          inputdata.size = value;
        });
    });
  new ea.obsidian.Setting(container)
    .setName(`ç±»å‹(Type)`)
    .addDropdown(dropdown => {
      typeList.forEach((item, index) => {
        dropdown.addOption(item, typeList2[index]);
      });
      dropdown
        .setValue(typeList[0])
        .onChange(value => {
          inputdata.type = value;
        });
    });

  new ea.obsidian.Setting(container)
    .setName(`ä½ç½®(Position)`)
    .addDropdown(dropdown => {
      positionList.forEach((item) => {
        dropdown.addOption(item, item);
      });
      dropdown
        .setValue(positionList[0])
        .onChange(value => {
          position = value;
        });
    });

  new ea.obsidian.Setting(container)
    .setName(`æ˜¯å¦é€æ˜èƒŒæ™¯`)
    .setDesc(`è®¾ç½®ä¸ºé€æ˜èƒŒæ™¯ï¼Œå¦åˆ™ä¸ºç™½åº•`)
    .addToggle(toggle => {
      toggle
        .setValue(isbg)
        .onChange(value => {
          isbg = value;
        });
    });
};

let isSend = false;
// åˆ›å»ºè‡ªå®šä¹‰æç¤ºæ¡†
const modal = new ea.obsidian.Modal(app);
modal.contentEl.createEl('h2', { text: 'Remove.bg - æŠ å›¾' });
customControls(modal.contentEl);
const confirmButton = modal.contentEl.createEl('button', { text: "Confirm" });
// æ·»åŠ æ ·å¼ä½¿æŒ‰é’®å±…å³
confirmButton.style.float = 'right';
confirmButton.addEventListener('click', async () => {
  isSend = true;
  await modal.close();
});

// ç¡®ä¿modalå…³é—­ååˆ¤æ–­isSendçš„çŠ¶æ€
await new Promise(resolve => {
  modal.onClose = () => {
    resolve();
  };
  modal.open();
});

if (!isSend) {
  new Notice("âŒremovebg cancelled");
  return;
}
inputdata.format = isbg ? 'png' : 'jpg';


const notice = new Notice("ğŸ”„removebg doing......", 0); // 0 è¡¨ç¤ºé€šçŸ¥å°†ä¸€ç›´æ˜¾ç¤º

for (let img of imgs) {
  const imgPath = await ea.plugin.filesMaster.get(img.fileId).path;
  const file = await app.vault.getAbstractFileByPath(imgPath);
  if (!file) {
    new Notice("Can't find file: " + imgPath);
    continue;
  }
  inputdata.filePath = app.vault.adapter.getFullPath(file.path);
  console.log(inputdata);

  // imgè½¬ä¸ºäºŒè¿›åˆ¶
  const filePath = inputdata.filePath;
  const fileBuffer = await fs.readFile(filePath);
  const fileBlob = new Blob([fileBuffer]);

  // ä¿å­˜removebgå›¾
  const timestamp = window.moment().format("YYYYMMDDHHmmss");
  let newFileName = `RemoveBg-${timestamp}${path.extname(filePath)}`;
  console.log(newFileName);

  // è°ƒç”¨removebg APIå»é™¤èƒŒæ™¯
  const rbgResultData = await removeBg(fileBlob, inputdata);

  // å›¾å½¢è¦†ç›–
  if (position === positionList[2]) {
    await app.vault.adapter.write(imgPath, Buffer.from(rbgResultData));
    await new Promise((resolve) => setTimeout(resolve, 200));
    await app.commands.executeCommandById("obsidian-excalidraw-plugin:save");
    continue;
  }
  const newFilePath = path.join(path.dirname(filePath), newFileName);
  // await app.vault.adapter.write(newFilePath, Buffer.from(rbgResultData));
  await fs.writeFile(newFilePath, Buffer.from(rbgResultData));
  await new Promise((resolve) => setTimeout(resolve, 200));

  // è·å–å›¾ç‰‡åœ¨Excalidrawçš„ä½ç½®ï¼Œä½¿removebgå›¾ä½äºå®ƒå³ä¾§
  let id = await ea.addImage(0, 0, newFileName);
  let el = ea.getElement(id);
  el.width = img.width;
  el.height = img.height;
  el.roundness = img.roundness;
  el.angle = img.angle;
  el.opacity = img.opacity;
  el.link = img.link;
  if (position === positionList[0]) {
    el.x = img.x + img.width + 10;
    el.y = img.y;
  } else if (position === positionList[1]) {
    el.x = img.x;
    el.y = img.y;
  }
  await ea.addElementsToView(false, true);
  await ea.moveViewElementToZIndex(el.id, 99);
}
new Notice("âœ…removebg done");
notice.hide(); // æ“ä½œå®Œæˆåæ‰‹åŠ¨å…³é—­é€šçŸ¥

async function removeBg(blob, inputdata) {
  const formData = new FormData();
  formData.append("size", inputdata.size);
  formData.append("type", inputdata.type);
  formData.append("format", inputdata.format);
  formData.append("image_file", blob);
  try {
    const response = await fetch("https://api.remove.bg/v1.0/removebg", {
      method: "POST",
      headers: { "X-Api-Key": inputdata.key },
      body: formData,
    });
    if (response.ok) {
      return await response.arrayBuffer();
    } else {
      throw new Error(`${response.status}: ${response.statusText}`);
    }
  } catch (error) {
    new Notice(`âŒ Error: ${error.message}`);
    notice.hide(); // æ“ä½œå®Œæˆåæ‰‹åŠ¨å…³é—­é€šçŸ¥
    throw error; // é‡æ–°æŠ›å‡ºé”™è¯¯ä»¥ä¾¿ä¸Šå±‚ä»£ç å¤„ç†
  }
};

```

## å‚è€ƒèµ„æ–™

- [äº‘æ‰˜ç®¡çš„åœ¨çº¿æŠ å›¾è½¯ä»¶ | remove.bg â€“ remove.bg](https://www.remove.bg/zh/g/developers)
- [Background Removal API â€“ remove.bg](https://www.remove.bg/zh/api#remove-background)

